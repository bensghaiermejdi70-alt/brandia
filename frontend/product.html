<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Produit - Brandia</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* [Styles identiques Ã  avant - je les mets pas pour allÃ©ger] */
    .brandia-ad-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(8px); z-index: 9999; display: none; align-items: center; justify-content: center; padding: 20px; }
    .brandia-ad-overlay.active { display: flex; }
    .brandia-ad-container { position: relative; width: 100%; max-width: 600px; background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-radius: 20px; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); border: 1px solid rgba(255, 255, 255, 0.1); animation: adSlideIn 0.4s ease-out; }
    @keyframes adSlideIn { from { opacity: 0; transform: translateY(30px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
    .brandia-ad-media { width: 100%; height: 300px; object-fit: cover; background: #0f172a; }
    .brandia-ad-video { width: 100%; height: 300px; object-fit: cover; background: #000; }
    .brandia-ad-content { padding: 24px; }
    .brandia-ad-close { position: absolute; top: 16px; right: 16px; width: 40px; height: 40px; background: rgba(0, 0, 0, 0.6); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 50%; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; z-index: 10; }
    .brandia-ad-close:hover { background: rgba(239, 68, 68, 0.9); transform: scale(1.1); }
    .brandia-ad-timer { position: absolute; top: 16px; left: 16px; background: rgba(0, 0, 0, 0.7); color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 6px; }
    .brandia-ad-progress { position: absolute; bottom: 0; left: 0; height: 4px; background: linear-gradient(90deg, #ec4899, #8b5cf6); transition: width 1s linear; }
    .brandia-ad-badge { display: inline-flex; align-items: center; gap: 6px; background: linear-gradient(135deg, #ec4899, #8b5cf6); color: white; padding: 6px 14px; border-radius: 20px; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; }
    .brandia-ad-headline { font-size: 22px; font-weight: 700; color: white; margin-bottom: 8px; line-height: 1.3; }
    .brandia-ad-description { font-size: 14px; color: #94a3b8; margin-bottom: 20px; line-height: 1.5; }
    .brandia-ad-cta { display: inline-flex; align-items: center; gap: 8px; background: linear-gradient(135deg, #ec4899, #8b5cf6); color: white; padding: 14px 28px; border-radius: 12px; font-weight: 600; text-decoration: none; transition: all 0.3s; border: none; cursor: pointer; }
    .brandia-ad-cta:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(236, 72, 153, 0.4); }
    .brandia-ad-footer { margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255, 255, 255, 0.1); font-size: 11px; color: #64748b; text-align: center; }
    .toast { position: fixed; bottom: 20px; right: 20px; padding: 16px 24px; border-radius: 12px; color: white; font-weight: 500; transform: translateY(100px); opacity: 0; transition: all 0.3s ease; z-index: 10000; display: flex; align-items: center; gap: 12px; }
    .toast.show { transform: translateY(0); opacity: 1; }
    .toast.success { background: #10b981; }
    .toast.error { background: #ef4444; }
    @media (max-width: 640px) { .brandia-ad-container { max-width: 100%; margin: 10px; } .brandia-ad-media, .brandia-ad-video { height: 200px; } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
  </style>
</head>
<body class="bg-slate-900 text-white min-h-screen">

  <!-- ========================================== -->
  <!-- DEBUG PANEL (Temporaire - Ã  supprimer aprÃ¨s) -->
  <!-- ========================================== -->
  <div id="debug-panel" class="fixed top-20 right-4 bg-black/80 text-green-400 p-4 rounded-lg text-xs font-mono z-50 max-w-xs hidden">
    <h4 class="text-white font-bold mb-2">ğŸ” DEBUG</h4>
    <div id="debug-content">Chargement...</div>
  </div>
  <button onclick="toggleDebug()" class="fixed top-20 right-4 z-50 bg-slate-800 text-white px-3 py-1 rounded text-xs">ğŸ› Debug</button>

  <!-- ========================================== -->
  <!-- HEADER -->
  <!-- ========================================== -->
  <header class="sticky top-0 z-40 bg-slate-900/95 backdrop-blur border-b border-slate-800">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <a href="index.html" class="flex items-center gap-2">
          <div class="w-8 h-8 bg-gradient-to-br from-pink-500 to-violet-600 rounded-lg flex items-center justify-center">
            <span class="font-bold text-white text-sm">B</span>
          </div>
          <span class="font-bold text-xl bg-gradient-to-r from-white to-slate-400 bg-clip-text text-transparent">Brandia</span>
        </a>

        <nav class="hidden md:flex items-center gap-8">
          <a href="catalogue.html" class="text-slate-300 hover:text-white transition">Catalogue</a>
          <a href="categories.html" class="text-slate-300 hover:text-white transition">CatÃ©gories</a>
          <a href="marques.html" class="text-slate-300 hover:text-white transition">Marques</a>
        </nav>

        <div class="flex items-center gap-4">
          <select id="countrySelector" class="bg-slate-800 border border-slate-700 rounded-lg px-3 py-1.5 text-sm text-slate-300 focus:outline-none focus:border-pink-500">
            <option value="AF">ğŸ‡¦ğŸ‡« Afghanistan</option>
  <option value="AL">ğŸ‡¦ğŸ‡± Albanie</option>
  <option value="DZ">ğŸ‡©ğŸ‡¿ AlgÃ©rie</option>
  <option value="AD">ğŸ‡¦ğŸ‡© Andorre</option>
  <option value="AO">ğŸ‡¦ğŸ‡´ Angola</option>
  <option value="AG">ğŸ‡¦ğŸ‡¬ Antigua-et-Barbuda</option>
  <option value="AR">ğŸ‡¦ğŸ‡· Argentine</option>
  <option value="AM">ğŸ‡¦ğŸ‡² ArmÃ©nie</option>
  <option value="AU">ğŸ‡¦ğŸ‡º Australie</option>
  <option value="AT">ğŸ‡¦ğŸ‡¹ Autriche</option>
  <option value="AZ">ğŸ‡¦ğŸ‡¿ AzerbaÃ¯djan</option>
  <option value="BS">ğŸ‡§ğŸ‡¸ Bahamas</option>
  <option value="BH">ğŸ‡§ğŸ‡­ BahreÃ¯n</option>
  <option value="BD">ğŸ‡§ğŸ‡© Bangladesh</option>
  <option value="BB">ğŸ‡§ğŸ‡§ Barbade</option>
  <option value="BY">ğŸ‡§ğŸ‡¾ BiÃ©lorussie</option>
  <option value="BE">ğŸ‡§ğŸ‡ª Belgique</option>
  <option value="BZ">ğŸ‡§ğŸ‡¿ Belize</option>
  <option value="BJ">ğŸ‡§ğŸ‡¯ BÃ©nin</option>
  <option value="BT">ğŸ‡§ğŸ‡¹ Bhoutan</option>
  <option value="BO">ğŸ‡§ğŸ‡´ Bolivie</option>
  <option value="BA">ğŸ‡§ğŸ‡¦ Bosnie-HerzÃ©govine</option>
  <option value="BW">ğŸ‡§ğŸ‡¼ Botswana</option>
  <option value="BR">ğŸ‡§ğŸ‡· BrÃ©sil</option>
  <option value="BN">ğŸ‡§ğŸ‡³ Brunei</option>
  <option value="BG">ğŸ‡§ğŸ‡¬ Bulgarie</option>
  <option value="BF">ğŸ‡§ğŸ‡« Burkina Faso</option>
  <option value="BI">ğŸ‡§ğŸ‡® Burundi</option>
  <option value="CV">ğŸ‡¨ğŸ‡» Cap-Vert</option>
  <option value="KH">ğŸ‡°ğŸ‡­ Cambodge</option>
  <option value="CM">ğŸ‡¨ğŸ‡² Cameroun</option>
  <option value="CA">ğŸ‡¨ğŸ‡¦ Canada</option>
  <option value="CF">ğŸ‡¨ğŸ‡« Centrafrique</option>
  <option value="TD">ğŸ‡¹ğŸ‡© Tchad</option>
  <option value="CL">ğŸ‡¨ğŸ‡± Chili</option>
  <option value="CN">ğŸ‡¨ğŸ‡³ Chine</option>
  <option value="CO">ğŸ‡¨ğŸ‡´ Colombie</option>
  <option value="KM">ğŸ‡°ğŸ‡² Comores</option>
  <option value="CG">ğŸ‡¨ğŸ‡¬ Congo</option>
  <option value="CD">ğŸ‡¨ğŸ‡© Congo (RDC)</option>
  <option value="CR">ğŸ‡¨ğŸ‡· Costa Rica</option>
  <option value="CI">ğŸ‡¨ğŸ‡® CÃ´te dâ€™Ivoire</option>
  <option value="HR">ğŸ‡­ğŸ‡· Croatie</option>
  <option value="CU">ğŸ‡¨ğŸ‡º Cuba</option>
  <option value="CY">ğŸ‡¨ğŸ‡¾ Chypre</option>
  <option value="CZ">ğŸ‡¨ğŸ‡¿ RÃ©publique tchÃ¨que</option>
  <option value="DK">ğŸ‡©ğŸ‡° Danemark</option>
  <option value="DJ">ğŸ‡©ğŸ‡¯ Djibouti</option>
  <option value="DM">ğŸ‡©ğŸ‡² Dominique</option>
  <option value="DO">ğŸ‡©ğŸ‡´ RÃ©publique dominicaine</option>
  <option value="EC">ğŸ‡ªğŸ‡¨ Ã‰quateur</option>
  <option value="EG">ğŸ‡ªğŸ‡¬ Ã‰gypte</option>
  <option value="SV">ğŸ‡¸ğŸ‡» Salvador</option>
  <option value="GQ">ğŸ‡¬ğŸ‡¶ GuinÃ©e Ã©quatoriale</option>
  <option value="ER">ğŸ‡ªğŸ‡· Ã‰rythrÃ©e</option>
  <option value="EE">ğŸ‡ªğŸ‡ª Estonie</option>
  <option value="ET">ğŸ‡ªğŸ‡¹ Ã‰thiopie</option>
  <option value="FJ">ğŸ‡«ğŸ‡¯ Fidji</option>
  <option value="FI">ğŸ‡«ğŸ‡® Finlande</option>
  <option value="FR">ğŸ‡«ğŸ‡· France</option>
  <option value="GA">ğŸ‡¬ğŸ‡¦ Gabon</option>
  <option value="GM">ğŸ‡¬ğŸ‡² Gambie</option>
  <option value="GE">ğŸ‡¬ğŸ‡ª GÃ©orgie</option>
  <option value="DE">ğŸ‡©ğŸ‡ª Allemagne</option>
  <option value="GH">ğŸ‡¬ğŸ‡­ Ghana</option>
  <option value="GR">ğŸ‡¬ğŸ‡· GrÃ¨ce</option>
  <option value="GD">ğŸ‡¬ğŸ‡© Grenade</option>
  <option value="GT">ğŸ‡¬ğŸ‡¹ Guatemala</option>
  <option value="GN">ğŸ‡¬ğŸ‡³ GuinÃ©e</option>
  <option value="GW">ğŸ‡¬ğŸ‡¼ GuinÃ©e-Bissau</option>
  <option value="GY">ğŸ‡¬ğŸ‡¾ Guyana</option>
  <option value="HT">ğŸ‡­ğŸ‡¹ HaÃ¯ti</option>
  <option value="HN">ğŸ‡­ğŸ‡³ Honduras</option>
  <option value="HU">ğŸ‡­ğŸ‡º Hongrie</option>
  <option value="IS">ğŸ‡®ğŸ‡¸ Islande</option>
  <option value="IN">ğŸ‡®ğŸ‡³ Inde</option>
  <option value="ID">ğŸ‡®ğŸ‡© IndonÃ©sie</option>
  <option value="IR">ğŸ‡®ğŸ‡· Iran</option>
  <option value="IQ">ğŸ‡®ğŸ‡¶ Irak</option>
  <option value="IE">ğŸ‡®ğŸ‡ª Irlande</option>
  <option value="IL">ğŸ‡®ğŸ‡± IsraÃ«l</option>
  <option value="IT">ğŸ‡®ğŸ‡¹ Italie</option>
  <option value="JM">ğŸ‡¯ğŸ‡² JamaÃ¯que</option>
  <option value="JP">ğŸ‡¯ğŸ‡µ Japon</option>
  <option value="JO">ğŸ‡¯ğŸ‡´ Jordanie</option>
  <option value="KZ">ğŸ‡°ğŸ‡¿ Kazakhstan</option>
  <option value="KE">ğŸ‡°ğŸ‡ª Kenya</option>
  <option value="KI">ğŸ‡°ğŸ‡® Kiribati</option>
  <option value="KP">ğŸ‡°ğŸ‡µ CorÃ©e du Nord</option>
  <option value="KR">ğŸ‡°ğŸ‡· CorÃ©e du Sud</option>
  <option value="KW">ğŸ‡°ğŸ‡¼ KoweÃ¯t</option>
  <option value="KG">ğŸ‡°ğŸ‡¬ Kirghizistan</option>
  <option value="LA">ğŸ‡±ğŸ‡¦ Laos</option>
  <option value="LV">ğŸ‡±ğŸ‡» Lettonie</option>
  <option value="LB">ğŸ‡±ğŸ‡§ Liban</option>
  <option value="LS">ğŸ‡±ğŸ‡¸ Lesotho</option>
  <option value="LR">ğŸ‡±ğŸ‡· LibÃ©ria</option>
  <option value="LY">ğŸ‡±ğŸ‡¾ Libye</option>
  <option value="LI">ğŸ‡±ğŸ‡® Liechtenstein</option>
  <option value="LT">ğŸ‡±ğŸ‡¹ Lituanie</option>
  <option value="LU">ğŸ‡±ğŸ‡º Luxembourg</option>
  <option value="MG">ğŸ‡²ğŸ‡¬ Madagascar</option>
  <option value="MW">ğŸ‡²ğŸ‡¼ Malawi</option>
  <option value="MY">ğŸ‡²ğŸ‡¾ Malaisie</option>
  <option value="MV">ğŸ‡²ğŸ‡» Maldives</option>
  <option value="ML">ğŸ‡²ğŸ‡± Mali</option>
  <option value="MT">ğŸ‡²ğŸ‡¹ Malte</option>
  <option value="MH">ğŸ‡²ğŸ‡­ Ãles Marshall</option>
  <option value="MR">ğŸ‡²ğŸ‡· Mauritanie</option>
  <option value="MU">ğŸ‡²ğŸ‡º Maurice</option>
  <option value="MX">ğŸ‡²ğŸ‡½ Mexique</option>
  <option value="FM">ğŸ‡«ğŸ‡² Ã‰tats fÃ©dÃ©rÃ©s de MicronÃ©sie</option>
  <option value="MD">ğŸ‡²ğŸ‡© Moldavie</option>
  <option value="MC">ğŸ‡²ğŸ‡¨ Monaco</option>
  <option value="MN">ğŸ‡²ğŸ‡³ Mongolie</option>
  <option value="ME">ğŸ‡²ğŸ‡ª MontÃ©nÃ©gro</option>
  <option value="MA">ğŸ‡²ğŸ‡¦ Maroc</option>
  <option value="MZ">ğŸ‡²ğŸ‡¿ Mozambique</option>
  <option value="MM">ğŸ‡²ğŸ‡² Myanmar</option>
  <option value="NA">ğŸ‡³ğŸ‡¦ Namibie</option>
  <option value="NR">ğŸ‡³ğŸ‡· Nauru</option>
  <option value="NP">ğŸ‡³ğŸ‡µ NÃ©pal</option>
  <option value="NL">ğŸ‡³ğŸ‡± Pays-Bas</option>
  <option value="NZ">ğŸ‡³ğŸ‡¿ Nouvelle-ZÃ©lande</option>
  <option value="NI">ğŸ‡³ğŸ‡® Nicaragua</option>
  <option value="NE">ğŸ‡³ğŸ‡ª Niger</option>
  <option value="NG">ğŸ‡³ğŸ‡¬ NigÃ©ria</option>
  <option value="NO">ğŸ‡³ğŸ‡´ NorvÃ¨ge</option>
  <option value="OM">ğŸ‡´ğŸ‡² Oman</option>
  <option value="PK">ğŸ‡µğŸ‡° Pakistan</option>
  <option value="PW">ğŸ‡µğŸ‡¼ Palaos</option>
  <option value="PA">ğŸ‡µğŸ‡¦ Panama</option>
  <option value="PG">ğŸ‡µğŸ‡¬ Papouasie-Nouvelle-GuinÃ©e</option>
  <option value="PY">ğŸ‡µğŸ‡¾ Paraguay</option>
  <option value="PE">ğŸ‡µğŸ‡ª PÃ©rou</option>
  <option value="PH">ğŸ‡µğŸ‡­ Philippines</option>
  <option value="PL">ğŸ‡µğŸ‡± Pologne</option>
  <option value="PT">ğŸ‡µğŸ‡¹ Portugal</option>
  <option value="QA">ğŸ‡¶ğŸ‡¦ Qatar</option>
  <option value="RO">ğŸ‡·ğŸ‡´ Roumanie</option>
  <option value="RU">ğŸ‡·ğŸ‡º Russie</option>
  <option value="RW">ğŸ‡·ğŸ‡¼ Rwanda</option>
  <option value="KN">ğŸ‡°ğŸ‡³ Saint-Kitts-et-Nevis</option>
  <option value="LC">ğŸ‡±ğŸ‡¨ Sainte-Lucie</option>
  <option value="VC">ğŸ‡»ğŸ‡¨ Saint-Vincent-et-les-Grenadines</option>
  <option value="WS">ğŸ‡¼ğŸ‡¸ Samoa</option>
  <option value="SM">ğŸ‡¸ğŸ‡² Saint-Marin</option>
  <option value="ST">ğŸ‡¸ğŸ‡¹ Sao TomÃ©-et-Principe</option>
  <option value="SA">ğŸ‡¸ğŸ‡¦ Arabie saoudite</option>
  <option value="SN">ğŸ‡¸ğŸ‡³ SÃ©nÃ©gal</option>
  <option value="RS">ğŸ‡·ğŸ‡¸ Serbie</option>
  <option value="SC">ğŸ‡¸ğŸ‡¨ Seychelles</option>
  <option value="SL">ğŸ‡¸ğŸ‡± Sierra Leone</option>
  <option value="SG">ğŸ‡¸ğŸ‡¬ Singapour</option>
  <option value="SK">ğŸ‡¸ğŸ‡° Slovaquie</option>
  <option value="SI">ğŸ‡¸ğŸ‡® SlovÃ©nie</option>
  <option value="SB">ğŸ‡¸ğŸ‡§ Ãles Salomon</option>
  <option value="SO">ğŸ‡¸ğŸ‡´ Somalie</option>
  <option value="ZA">ğŸ‡¿ğŸ‡¦ Afrique du Sud</option>
  <option value="ES">ğŸ‡ªğŸ‡¸ Espagne</option>
  <option value="LK">ğŸ‡±ğŸ‡° Sri Lanka</option>
  <option value="SD">ğŸ‡¸ğŸ‡© Soudan</option>
  <option value="SR">ğŸ‡¸ğŸ‡· Suriname</option>
  <option value="SE">ğŸ‡¸ğŸ‡ª SuÃ¨de</option>
  <option value="CH">ğŸ‡¨ğŸ‡­ Suisse</option>
  <option value="SY">ğŸ‡¸ğŸ‡¾ Syrie</option>
  <option value="TW">ğŸ‡¹ğŸ‡¼ TaÃ¯wan</option>
  <option value="TJ">ğŸ‡¹ğŸ‡¯ Tadjikistan</option>
  <option value="TZ">ğŸ‡¹ğŸ‡¿ Tanzanie</option>
  <option value="TH">ğŸ‡¹ğŸ‡­ ThaÃ¯lande</option>
  <option value="TL">ğŸ‡¹ğŸ‡± Timor oriental</option>
  <option value="TG">ğŸ‡¹ğŸ‡¬ Togo</option>
  <option value="TO">ğŸ‡¹ğŸ‡´ Tonga</option>
  <option value="TT">ğŸ‡¹ğŸ‡¹ TrinitÃ©-et-Tobago</option>
  <option value="TN">ğŸ‡¹ğŸ‡³ Tunisie</option>
  <option value="TR">ğŸ‡¹ğŸ‡· Turquie</option>
  <option value="TM">ğŸ‡¹ğŸ‡² TurkmÃ©nistan</option>
  <option value="UG">ğŸ‡ºğŸ‡¬ Ouganda</option>
  <option value="UA">ğŸ‡ºğŸ‡¦ Ukraine</option>
  <option value="AE">ğŸ‡¦ğŸ‡ª Ã‰mirats arabes unis</option>
  <option value="GB">ğŸ‡¬ğŸ‡§ Royaume-Uni</option>
  <option value="US">ğŸ‡ºğŸ‡¸ Ã‰tats-Unis</option>
  <option value="UY">ğŸ‡ºğŸ‡¾ Uruguay</option>
  <option value="UZ">ğŸ‡ºğŸ‡¿ OuzbÃ©kistan</option>
  <option value="VU">ğŸ‡»ğŸ‡º Vanuatu</option>
  <option value="VE">ğŸ‡»ğŸ‡ª Venezuela</option>
  <option value="VN">ğŸ‡»ğŸ‡³ ViÃªt Nam</option>
  <option value="YE">ğŸ‡¾ğŸ‡ª YÃ©men</option>
  <option value="ZM">ğŸ‡¿ğŸ‡² Zambie</option>
  <option value="ZW">ğŸ‡¿ğŸ‡¼ Zimbabwe</option>
          </select>

          <a href="panier.html" class="relative p-2 text-slate-300 hover:text-white transition">
            <i class="fas fa-shopping-cart text-xl"></i>
            <span id="cart-count" class="absolute -top-1 -right-1 w-5 h-5 bg-pink-500 rounded-full text-xs flex items-center justify-center font-bold hidden">0</span>
          </a>

          <div id="auth-buttons">
            <a href="login.html" class="text-slate-300 hover:text-white transition text-sm">Connexion</a>
          </div>
          <div id="user-menu" class="hidden items-center gap-3">
            <span id="user-name" class="text-sm text-slate-300"></span>
            <button onclick="logout()" class="text-slate-400 hover:text-white transition">
              <i class="fas fa-sign-out-alt"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- ========================================== -->
  <!-- CONTENU PRODUIT -->
  <!-- ========================================== -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div id="product-container" class="grid grid-cols-1 lg:grid-cols-2 gap-12">
      <div class="col-span-full flex items-center justify-center py-20">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500"></div>
        <span class="ml-4 text-slate-400">Chargement du produit...</span>
      </div>
    </div>
  </main>

  <!-- ========================================== -->
  <!-- PUBLICITÃ‰ CONTEXTUELLE -->
  <!-- ========================================== -->
  <div id="brandia-ad-overlay" class="brandia-ad-overlay">
    <div class="brandia-ad-container">
      <div class="brandia-ad-timer">
        <i class="fas fa-clock"></i>
        <span id="ad-timer-text">15s</span>
      </div>
      <button class="brandia-ad-close" onclick="brandiaAds.close()" title="Fermer (Esc)">
        <i class="fas fa-times"></i>
      </button>
      <div id="ad-media-container"></div>
      <div class="brandia-ad-progress" id="ad-progress" style="width: 100%"></div>
      <div class="brandia-ad-content">
        <div class="brandia-ad-badge">
          <i class="fas fa-bullhorn"></i>
          Offre spÃ©ciale
        </div>
        <h3 id="ad-headline" class="brandia-ad-headline">Titre de la campagne</h3>
        <p id="ad-description" class="brandia-ad-description">Description de l'offre</p>
        <a id="ad-cta" href="#" class="brandia-ad-cta" target="_blank" onclick="brandiaAds.trackClick()">
          <span>Voir l'offre</span>
          <i class="fas fa-arrow-right"></i>
        </a>
        <div class="brandia-ad-footer">
          <i class="fas fa-info-circle mr-1"></i>
          Contenu proposÃ© par la marque que vous consultez
        </div>
      </div>
    </div>
  </div>

  <!-- ========================================== -->
  <!-- FOOTER -->
  <!-- ========================================== -->
  <footer class="bg-slate-900 border-t border-slate-800 mt-20">
    <div class="max-w-7xl mx-auto px-4 py-8 text-center text-slate-500 text-sm">
      <p>&copy; 2026 Brandia. Tous droits rÃ©servÃ©s.</p>
    </div>
  </footer>

  <!-- ========================================== -->
  <!-- SCRIPTS -->
  <!-- ========================================== -->
  
  <script src="assets/js/api.js"></script>
  <script src="assets/js/brandia-ads.js"></script>
  
  <script>
    // ==========================================
    // DEBUG PANEL
    // ==========================================
    function toggleDebug() {
      const panel = document.getElementById('debug-panel');
      panel.classList.toggle('hidden');
    }

    function logDebug(msg, data) {
      console.log(msg, data);
      const content = document.getElementById('debug-content');
      if (content) {
        content.innerHTML += `<div class="mb-1 border-b border-slate-700 pb-1">${msg}: ${JSON.stringify(data)}</div>`;
      }
    }

    window.currentProduct = null;

    // ==========================================
    // CHARGEMENT PRODUIT AVEC DEBUG
    // ==========================================
    async function loadProduct() {
      const urlParams = new URLSearchParams(window.location.search);
      const productId = urlParams.get('id');
      
      logDebug('Product ID from URL', productId);
      
      if (!productId) {
        showError('ID produit manquant dans l\'URL');
        return;
      }

      try {
        logDebug('Calling API', 'getByIdWithPromotion(' + productId + ')');
        const response = await BrandiaAPI.Products.getByIdWithPromotion(productId);
        
        logDebug('API Response', {
          success: response.success,
          hasData: !!response.data,
          keys: response.data ? Object.keys(response.data) : null
        });

        if (!response.success) {
          throw new Error(response.message || 'Produit non trouvÃ©');
        }
        
        // ğŸ”¥ CORRECTION : GÃ©rer diffÃ©rentes structures de rÃ©ponse
        let productData = response.data?.product || response.data;
        
        logDebug('Raw product data', productData);
        logDebug('Product keys', Object.keys(productData));
        logDebug('supplier_id value', productData.supplier_id);
        logDebug('supplier object', productData.supplier);

        if (!productData) {
          throw new Error('DonnÃ©es produit vides');
        }

        // ğŸ”¥ CORRECTION : Extraire supplier_id de diffÃ©rentes sources possibles
        const supplierId = productData.supplier_id || 
                          productData.supplier?.id || 
                          productData.supplier_id_fk ||
                          null;

        logDebug('Extracted supplier_id', supplierId);

        // EXPOSER POUR LA PUBLICITÃ‰
        window.currentProduct = {
          id: productData.id,
          supplier_id: supplierId,
          name: productData.name,
          category_id: productData.category_id,
          stock: productData.stock
        };
        
        logDebug('window.currentProduct set', window.currentProduct);

        renderProduct(productData);
        
        // DÃ©clencher publicitÃ© aprÃ¨s rendu
        setTimeout(() => {
          triggerAdCheck();
        }, 1500);

      } catch (err) {
        logDebug('ERROR', err.message);
        showError(err.message);
      }
    }

    // ==========================================
    // DÃ‰CLENCHEMENT PUBLICITÃ‰ AVEC DEBUG
    // ==========================================
    function triggerAdCheck() {
      logDebug('=== AD CHECK ===', {
        currentProduct: window.currentProduct,
        brandiaAdsExists: !!window.brandiaAds
      });
      
      if (!window.currentProduct?.supplier_id) {
        logDebug('âŒ BLOCKED - No supplier_id', window.currentProduct);
        return;
      }
      
      if (!window.brandiaAds) {
        logDebug('âŒ BLOCKED - brandiaAds not loaded', null);
        setTimeout(triggerAdCheck, 1000);
        return;
      }
      
      const sessionKey = `ad_seen_${window.currentProduct.supplier_id}_${window.currentProduct.id}`;
      if (sessionStorage.getItem(sessionKey)) {
        logDebug('âŒ BLOCKED - Already seen this session', sessionKey);
        return;
      }
      
      logDebug('âœ… TRIGGERING AD', {
        productId: window.currentProduct.id,
        supplierId: window.currentProduct.supplier_id
      });
      
      window.brandiaAds.checkAndShow(
        window.currentProduct.id, 
        window.currentProduct.supplier_id
      );
    }

    // ==========================================
    // RENDU PRODUIT (CORRIGÃ‰ POUR SUPPLIER)
    // ==========================================
    function renderProduct(product) {
      const container = document.getElementById('product-container');
      
      // ğŸ”¥ CORRECTION : Extraire toutes les donnÃ©es possibles
      const hasPromo = product.has_promotion || product.promotion || product.discount > 0;
      const finalPrice = parseFloat(product.final_price || product.price || 0);
      const originalPrice = hasPromo ? parseFloat(product.base_price || product.price || 0) : null;
      const discount = hasPromo && originalPrice ? Math.round((1 - finalPrice/originalPrice) * 100) : 0;
      
      const mainImage = product.main_image_url || product.image || 'https://images.unsplash.com/photo-1555529669-e69e7aa0ba9a?w=800';
      
      // ğŸ”¥ CORRECTION : Extraire supplier de toutes les sources possibles
      const supplierId = product.supplier_id || product.supplier?.id || null;
      const supplierName = product.supplier?.company_name || 
                          product.supplier?.name || 
                          product.brand_name || 
                          product.supplier_name ||
                          'Marque partenaire';
      const supplierLogo = product.supplier?.logo_url || null;
      
      logDebug('Rendering with supplier', { supplierId, supplierName });

      container.innerHTML = `
        <!-- Galerie -->
        <div class="space-y-4">
          <div class="aspect-square rounded-2xl overflow-hidden bg-slate-800 relative group">
            <img id="main-image" src="${mainImage}" 
                 class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                 alt="${product.name}"
                 onerror="this.src='https://images.unsplash.com/photo-1555529669-e69e7aa0ba9a?w=800'">
            ${hasPromo ? `
              <div class="absolute top-4 left-4 bg-gradient-to-r from-pink-500 to-rose-500 text-white px-4 py-2 rounded-full font-bold text-sm animate-pulse">
                -${discount}%
              </div>
            ` : ''}
          </div>
        </div>

        <!-- Infos -->
        <div class="space-y-6">
          <!-- Marque avec lien -->
          <div class="flex items-center gap-3">
            ${supplierLogo ? `
              <img src="${supplierLogo}" class="w-10 h-10 rounded-full object-cover border border-slate-700 bg-slate-800" onerror="this.style.display='none'">
            ` : '<div class="w-10 h-10 rounded-full bg-gradient-to-br from-pink-500 to-violet-600 flex items-center justify-center"><i class="fas fa-store text-white text-sm"></i></div>'}
            <div>
              <p class="text-sm text-slate-400">Vendu par</p>
              ${supplierId ? `
                <a href="brand.html?id=${supplierId}" class="text-pink-400 hover:text-pink-300 font-medium transition">
                  ${supplierName}
                </a>
              ` : `
                <span class="text-slate-300 font-medium">${supplierName}</span>
              `}
            </div>
          </div>

          <h1 class="text-3xl md:text-4xl font-bold text-white leading-tight">
            ${product.name || 'Produit sans nom'}
          </h1>

          <div class="flex items-baseline gap-4 flex-wrap">
            <span class="text-4xl font-bold text-white">${formatPrice(finalPrice)}</span>
            ${hasPromo && originalPrice ? `
              <span class="text-xl text-slate-500 line-through">${formatPrice(originalPrice)}</span>
              <span class="bg-emerald-500/20 text-emerald-400 px-3 py-1 rounded-full text-sm font-medium">
                Ã‰conomisez ${formatPrice(originalPrice - finalPrice)}
              </span>
            ` : ''}
          </div>

          <p class="text-slate-300 leading-relaxed">
            ${product.description || 'Aucune description disponible pour ce produit.'}
          </p>

          <!-- Stock avec couleur dynamique -->
          <div class="flex items-center gap-2 ${product.stock > 0 ? 'text-emerald-400' : 'text-red-400'}">
            <i class="fas ${product.stock > 0 ? 'fa-check-circle' : 'fa-times-circle'}"></i>
            <span class="font-medium">
              ${product.stock > 0 ? `En stock (${product.stock} disponibles)` : 'Rupture de stock'}
            </span>
          </div>

          <!-- Actions -->
          <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-slate-800">
            <div class="flex items-center border border-slate-700 rounded-xl overflow-hidden bg-slate-800">
              <button onclick="updateQuantity(-1)" class="px-4 py-3 hover:bg-slate-700 transition text-slate-400">
                <i class="fas fa-minus"></i>
              </button>
              <input type="number" id="quantity" value="1" min="1" max="${product.stock || 1}" 
                     class="w-16 text-center bg-transparent border-x border-slate-700 py-3 text-white font-medium focus:outline-none"
                     ${product.stock <= 0 ? 'disabled' : ''}>
              <button onclick="updateQuantity(1)" class="px-4 py-3 hover:bg-slate-700 transition text-slate-400" ${product.stock <= 0 ? 'disabled' : ''}>
                <i class="fas fa-plus"></i>
              </button>
            </div>

            <button onclick="addToCart(${product.id})" 
                    class="flex-1 bg-gradient-to-r from-pink-500 to-violet-600 hover:from-pink-600 hover:to-violet-700 text-white font-bold py-3 px-8 rounded-xl transition transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 shadow-lg shadow-pink-500/25"
                    ${product.stock <= 0 ? 'disabled' : ''}>
              <i class="fas fa-shopping-cart"></i>
              <span>${product.stock > 0 ? 'Ajouter au panier' : 'Indisponible'}</span>
            </button>

            <button class="p-3 border border-slate-700 rounded-xl hover:bg-slate-800 transition text-slate-400 hover:text-pink-500 bg-slate-800/50">
              <i class="far fa-heart text-xl"></i>
            </button>
          </div>

          <div class="bg-slate-800/50 rounded-xl p-4 space-y-3 border border-slate-700/50">
            <div class="flex items-center gap-3 text-sm text-slate-300">
              <i class="fas fa-truck text-pink-500"></i>
              <span>Livraison estimÃ©e: <strong class="text-white">3-5 jours ouvrÃ©s</strong></span>
            </div>
            <div class="flex items-center gap-3 text-sm text-slate-300">
              <i class="fas fa-shield-alt text-emerald-500"></i>
              <span>Paiement sÃ©curisÃ© par Stripe</span>
            </div>
          </div>

          <div class="text-xs text-slate-500 pt-4 border-t border-slate-800">
            RÃ©f: BRD-${String(product.id).padStart(6, '0')} 
            ${supplierId ? `| Fournisseur ID: ${supplierId}` : ''}
          </div>
        </div>
      `;
    }

    // ==========================================
    // FONCTIONS UTILITAIRES
    // ==========================================
    function updateQuantity(delta) {
      const input = document.getElementById('quantity');
      if (!input || input.disabled) return;
      const current = parseInt(input.value) || 1;
      const max = parseInt(input.max) || 99;
      input.value = Math.max(1, Math.min(max, current + delta));
    }

    async function addToCart(productId) {
      const qty = parseInt(document.getElementById('quantity')?.value) || 1;
      try {
        const res = await BrandiaAPI.Products.getByIdWithPromotion(productId);
        if (!res.success) throw new Error('Produit non trouvÃ©');
        const p = res.data?.product || res.data;
        
        BrandiaAPI.Cart.add({
          id: p.id,
          product_id: p.id,
          name: p.name,
          price: parseFloat(p.final_price || p.price),
          base_price: parseFloat(p.base_price || p.price),
          has_promotion: p.has_promotion || false,
          main_image_url: p.main_image_url || p.image,
          stock: p.stock
        }, qty);
        
        showToast('Produit ajoutÃ© au panier !', 'success');
        updateCartBadge();
      } catch (e) {
        showToast('Erreur: ' + e.message, 'error');
      }
    }

    function formatPrice(a) {
      return new Intl.NumberFormat('fr-FR', {style: 'currency', currency: 'EUR'}).format(a || 0);
    }

    function showError(m) {
      document.getElementById('product-container').innerHTML = `
        <div class="col-span-full text-center py-20">
          <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-red-500/10 flex items-center justify-center">
            <i class="fas fa-exclamation-triangle text-3xl text-red-500"></i>
          </div>
          <h2 class="text-2xl font-bold text-white mb-2">Erreur</h2>
          <p class="text-slate-400 mb-6">${m}</p>
          <a href="catalogue.html" class="text-pink-400 hover:text-pink-300">â† Retour au catalogue</a>
        </div>
      `;
    }

    function showToast(m, t = 'success') {
      const old = document.querySelector('.toast');
      if (old) old.remove();
      const toast = document.createElement('div');
      toast.className = `toast ${t}`;
      toast.innerHTML = `<i class="fas ${t === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i><span>${m}</span>`;
      document.body.appendChild(toast);
      requestAnimationFrame(() => toast.classList.add('show'));
      setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 300); }, 3000);
    }

    function initCountries() {
      const sel = document.getElementById('countrySelector');
      if (!sel) return;
      const countries = { 'FR': {n:'France',c:'EUR'}, 'TN': {n:'Tunisie',c:'TND'}, 'DE': {n:'Allemagne',c:'EUR'}, 'IT': {n:'Italie',c:'EUR'}, 'ES': {n:'Espagne',c:'EUR'} };
      const saved = localStorage.getItem('country') || 'FR';
      sel.innerHTML = Object.entries(countries).map(([code, c]) => `<option value="${code}" ${code===saved?'selected':''}>${c.n}</option>`).join('');
      sel.onchange = (e) => { localStorage.setItem('country', e.target.value); localStorage.setItem('currency', countries[e.target.value].c); };
    }

    function initAuth() {
      const u = BrandiaAPI?.Auth?.getUser ? BrandiaAPI.Auth.getUser() : null;
      const ab = document.getElementById('auth-buttons');
      const um = document.getElementById('user-menu');
      const un = document.getElementById('user-name');
      if (u?.email) {
        if (ab) ab.classList.add('hidden');
        if (um) { um.classList.remove('hidden'); um.classList.add('flex'); }
        if (un) un.textContent = u.first_name || u.email.split('@')[0];
      }
    }

    function logout() {
      if (BrandiaAPI?.Auth?.logout) BrandiaAPI.Auth.logout();
      else { localStorage.clear(); window.location.href = 'index.html'; }
    }

    function updateCartBadge() {
      if (BrandiaAPI?.Cart?.updateBadge) BrandiaAPI.Cart.updateBadge();
      else {
        const c = JSON.parse(localStorage.getItem('brandia_cart') || '[]').reduce((s, i) => s + (parseInt(i.quantity) || 0), 0);
        const b = document.getElementById('cart-count');
        if (b) { b.textContent = c > 99 ? '99+' : c; b.classList.toggle('hidden', c === 0); }
      }
    }

    // DÃ©marrage
    document.addEventListener('DOMContentLoaded', () => {
      initCountries();
      initAuth();
      updateCartBadge();
      setTimeout(loadProduct, 100);
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && window.brandiaAds) window.brandiaAds.close();
    });
  </script>

</body>
</html>