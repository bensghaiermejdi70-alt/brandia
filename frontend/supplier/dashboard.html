<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Fournisseur - Brandia</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --accent: #6366f1;
      --accent-hover: #4f46e5;
    }
    
    body { 
      background-color: var(--bg-primary); 
      color: #f1f5f9; 
      font-family: 'Inter', system-ui, sans-serif;
    }
    
    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg-secondary); }
    ::-webkit-scrollbar-thumb { background: var(--bg-tertiary); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #475569; }
    
    /* Navigation */
    .nav-link { 
      transition: all 0.2s ease;
      position: relative;
    }
    .nav-link.active {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      color: white;
    }
    .nav-link:not(.active):hover {
      background-color: rgba(99, 102, 241, 0.1);
      color: #818cf8;
    }
    .nav-link.active::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 3px;
      height: 20px;
      background: #818cf8;
      border-radius: 0 2px 2px 0;
    }
    
    /* Sections */
    .section { 
      display: none; 
      animation: fadeIn 0.3s ease-out;
    }
    .section.active { 
      display: block; 
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Cards */
    .card {
      background: var(--bg-secondary);
      border: 1px solid rgba(148, 163, 184, 0.1);
      transition: all 0.3s ease;
    }
    .card:hover {
      border-color: rgba(99, 102, 241, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.3);
    }
    
    /* Status badges */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .badge-draft { background: #64748b; color: white; }
    .badge-published { background: #10b981; color: white; }
    .badge-archived { background: #ef4444; color: white; }
    .badge-pending { background: #f59e0b; color: #000; }
    .badge-paid { background: #3b82f6; color: white; }
    .badge-shipped { background: #8b5cf6; color: white; }
    .badge-delivered { background: #059669; color: white; }
    .badge-cancelled { background: #ef4444; color: white; }
    .badge-processing { background: #f97316; color: white; }
    
    /* Buttons */
    .btn-primary {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      transition: all 0.3s;
    }
    .btn-primary:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.4);
    }
    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    /* Tables */
    .table-row:hover {
      background-color: rgba(99, 102, 241, 0.05);
    }
    
    /* Modals */
    .modal-backdrop {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
    }
    
    /* Charts */
    .chart-container {
      position: relative;
      height: 300px;
    }
    
    /* Toggle switch */
    .toggle {
      appearance: none;
      width: 44px;
      height: 24px;
      background: #334155;
      border-radius: 12px;
      position: relative;
      cursor: pointer;
      transition: background 0.3s;
    }
    .toggle::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: transform 0.3s;
    }
    .toggle:checked {
      background: #6366f1;
    }
    .toggle:checked::after {
      transform: translateX(20px);
    }

    /* Loading states */
    .skeleton {
      background: linear-gradient(90deg, #334155 25%, #475569 50%, #334155 75%);
      background-size: 200% 100%;
      animation: skeleton 1.5s infinite;
    }
    @keyframes skeleton {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Order tabs */
    .order-tab.active {
      background: #6366f1;
      color: white;
    }

    /* Image upload preview */
    .image-preview {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid #334155;
    }
  </style>
</head>
<body class="antialiased">

<!-- Sidebar -->
<aside class="fixed left-0 top-0 h-full w-64 bg-slate-900 border-r border-slate-800 z-50 flex flex-col">
  <!-- Logo -->
  <div class="p-6 border-b border-slate-800">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg shadow-indigo-500/30">
        <i class="fas fa-store text-white"></i>
      </div>
      <div>
        <h1 class="font-bold text-lg tracking-tight">Brandia</h1>
        <p class="text-xs text-slate-400">Espace Fournisseur</p>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <nav class="flex-1 overflow-y-auto py-4 px-3 space-y-1">
    <button onclick="navigate('overview')" id="nav-overview" class="nav-link active w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium text-white">
      <i class="fas fa-chart-line w-5 text-center"></i>
      <span>Tableau de bord</span>
    </button>
    
    <button onclick="navigate('products')" id="nav-products" class="nav-link w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium text-slate-400">
      <i class="fas fa-box w-5 text-center"></i>
      <span>Produits</span>
      <span id="product-count" class="ml-auto bg-indigo-500/20 text-indigo-400 px-2 py-0.5 rounded-full text-xs hidden">0</span>
    </button>
    
    <button onclick="navigate('promotions')" id="nav-promotions" class="nav-link w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium text-slate-400">
      <i class="fas fa-percent w-5 text-center"></i>
      <span>Promotions</span>
    </button>
    
    <button onclick="navigate('orders')" id="nav-orders" class="nav-link w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium text-slate-400">
      <i class="fas fa-shopping-bag w-5 text-center"></i>
      <span>Commandes</span>
      <span id="order-badge" class="ml-auto bg-red-500 text-white px-2 py-0.5 rounded-full text-xs hidden">0</span>
    </button>
    
    <button onclick="navigate('payments')" id="nav-payments" class="nav-link w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium text-slate-400">
      <i class="fas fa-euro-sign w-5 text-center"></i>
      <span>Paiements</span>
    </button>
    
    <button onclick="navigate('analytics')" id="nav-analytics" class="nav-link w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium text-slate-400">
      <i class="fas fa-chart-bar w-5 text-center"></i>
      <span>Statistiques</span>
    </button>
    
    <button onclick="navigate('profile')" id="nav-profile" class="nav-link w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium text-slate-400">
      <i class="fas fa-building w-5 text-center"></i>
      <span>Profil marque</span>
    </button>
    
    <button onclick="navigate('support')" id="nav-support" class="nav-link w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium text-slate-400">
      <i class="fas fa-headset w-5 text-center"></i>
      <span>Support</span>
    </button>
    
    <button onclick="navigate('settings')" id="nav-settings" class="nav-link w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium text-slate-400">
      <i class="fas fa-cog w-5 text-center"></i>
      <span>Paramètres</span>
    </button>
  </nav>

  <!-- User & Logout -->
  <div class="p-4 border-t border-slate-800">
    <div class="flex items-center gap-3 mb-4 px-2">
      <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center">
        <i class="fas fa-user text-white text-sm"></i>
      </div>
      <div class="flex-1 min-w-0">
        <p id="user-name" class="text-sm font-medium truncate">Chargement...</p>
        <p id="user-role" class="text-xs text-slate-400">Fournisseur</p>
      </div>
    </div>
    <button onclick="logout()" class="w-full flex items-center gap-3 px-4 py-2.5 rounded-lg text-red-400 hover:bg-red-500/10 transition-colors text-sm font-medium">
      <i class="fas fa-sign-out-alt w-5 text-center"></i>
      <span>Déconnexion</span>
    </button>
  </div>
</aside>

<!-- Main Content -->
<main class="ml-64 min-h-screen bg-slate-950">
  <!-- Header -->
  <header class="sticky top-0 z-40 bg-slate-900/80 backdrop-blur border-b border-slate-800 px-8 py-4">
    <div class="flex justify-between items-center">
      <div>
        <h2 id="page-title" class="text-2xl font-bold text-white">Tableau de bord</h2>
        <p id="page-subtitle" class="text-sm text-slate-400 mt-1">Vue d'ensemble de votre activité</p>
      </div>
      
      <div class="flex items-center gap-4">
        <!-- Search -->
        <div class="relative hidden md:block">
          <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"></i>
          <input type="text" id="global-search" placeholder="Rechercher..." 
                 class="bg-slate-800 border border-slate-700 rounded-lg pl-10 pr-4 py-2 text-sm focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none w-64">
        </div>
        
        <!-- Notifications -->
        <button class="relative p-2 text-slate-400 hover:text-white transition-colors" onclick="showNotifications()">
          <i class="fas fa-bell text-lg"></i>
          <span id="notif-badge" class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full hidden"></span>
        </button>
        
        <!-- Quick Actions -->
        <button onclick="quickAction()" class="btn-primary px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2">
          <i class="fas fa-plus"></i>
          <span class="hidden sm:inline">Action rapide</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Content Container -->
  <div class="p-8 max-w-7xl mx-auto">
    
    <!-- ========================================== -->
    <!-- SECTION: OVERVIEW (Tableau de bord) -->
    <!-- ========================================== -->
    <section id="overview" class="section active space-y-6">
      <!-- KPI Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="card rounded-xl p-6">
          <div class="flex justify-between items-start">
            <div>
              <p class="text-slate-400 text-xs uppercase tracking-wider font-semibold">Chiffre d'affaires</p>
              <p class="text-3xl font-bold text-emerald-400 mt-2" id="kpi-revenue">
                <span class="skeleton w-24 h-8 rounded inline-block"></span>
              </p>
              <p class="text-xs text-emerald-400/70 mt-1 flex items-center gap-1" id="kpi-revenue-trend">
                <i class="fas fa-spinner fa-spin"></i> Chargement...
              </p>
            </div>
            <div class="w-12 h-12 bg-emerald-500/10 rounded-xl flex items-center justify-center">
              <i class="fas fa-euro-sign text-emerald-400 text-xl"></i>
            </div>
          </div>
        </div>

        <div class="card rounded-xl p-6">
          <div class="flex justify-between items-start">
            <div>
              <p class="text-slate-400 text-xs uppercase tracking-wider font-semibold">Commandes</p>
              <p class="text-3xl font-bold text-blue-400 mt-2" id="kpi-orders">
                <span class="skeleton w-16 h-8 rounded inline-block"></span>
              </p>
              <p class="text-xs text-blue-400/70 mt-1 flex items-center gap-1" id="kpi-orders-trend">
                <i class="fas fa-spinner fa-spin"></i> Chargement...
              </p>
            </div>
            <div class="w-12 h-12 bg-blue-500/10 rounded-xl flex items-center justify-center">
              <i class="fas fa-shopping-bag text-blue-400 text-xl"></i>
            </div>
          </div>
        </div>

        <div class="card rounded-xl p-6">
          <div class="flex justify-between items-start">
            <div>
              <p class="text-slate-400 text-xs uppercase tracking-wider font-semibold">Produits actifs</p>
              <p class="text-3xl font-bold text-indigo-400 mt-2" id="kpi-products">
                <span class="skeleton w-16 h-8 rounded inline-block"></span>
              </p>
              <p class="text-xs text-indigo-400/70 mt-1">sur <span id="kpi-total-products">-</span> total</p>
            </div>
            <div class="w-12 h-12 bg-indigo-500/10 rounded-xl flex items-center justify-center">
              <i class="fas fa-box text-indigo-400 text-xl"></i>
            </div>
          </div>
        </div>

        <div class="card rounded-xl p-6">
          <div class="flex justify-between items-start">
            <div>
              <p class="text-slate-400 text-xs uppercase tracking-wider font-semibold">À recevoir</p>
              <p class="text-3xl font-bold text-amber-400 mt-2" id="kpi-balance">
                <span class="skeleton w-24 h-8 rounded inline-block"></span>
              </p>
              <p class="text-xs text-amber-400/70 mt-1" id="next-payout-date">Prochain virement: --/--</p>
            </div>
            <div class="w-12 h-12 bg-amber-500/10 rounded-xl flex items-center justify-center">
              <i class="fas fa-wallet text-amber-400 text-xl"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Row -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Sales Chart -->
        <div class="card rounded-xl p-6 lg:col-span-2">
          <div class="flex justify-between items-center mb-6">
            <h3 class="font-semibold text-lg">Évolution des ventes</h3>
            <select id="sales-period" onchange="updateSalesChart()" class="bg-slate-800 border border-slate-700 rounded-lg px-3 py-1.5 text-sm focus:border-indigo-500 outline-none">
              <option value="7">7 derniers jours</option>
              <option value="30">30 derniers jours</option>
              <option value="month">Ce mois</option>
              <option value="year">Cette année</option>
            </select>
          </div>
          <div class="chart-container">
            <canvas id="salesChart"></canvas>
          </div>
        </div>

        <!-- Top Products -->
        <div class="card rounded-xl p-6">
          <h3 class="font-semibold text-lg mb-6">Top produits</h3>
          <div id="top-products-list" class="space-y-4">
            <div class="text-center py-8 text-slate-500">
              <i class="fas fa-spinner fa-spin text-3xl mb-3"></i>
              <p class="text-sm">Chargement...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Orders -->
      <div class="card rounded-xl overflow-hidden">
        <div class="p-6 border-b border-slate-800 flex justify-between items-center">
          <h3 class="font-semibold text-lg">Commandes récentes</h3>
          <button onclick="navigate('orders')" class="text-indigo-400 hover:text-indigo-300 text-sm font-medium">
            Voir tout <i class="fas fa-arrow-right ml-1"></i>
          </button>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead class="bg-slate-800/50 text-slate-400 text-xs uppercase">
              <tr>
                <th class="text-left py-4 px-6 font-semibold">N° Commande</th>
                <th class="text-left py-4 px-6 font-semibold">Date</th>
                <th class="text-left py-4 px-6 font-semibold">Client</th>
                <th class="text-right py-4 px-6 font-semibold">Montant</th>
                <th class="text-center py-4 px-6 font-semibold">Statut</th>
              </tr>
            </thead>
            <tbody id="recent-orders-list" class="divide-y divide-slate-800">
              <tr>
                <td colspan="5" class="py-8 text-center text-slate-500">
                  <i class="fas fa-spinner fa-spin mr-2"></i>Chargement...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- ========================================== -->
    <!-- SECTION: PRODUCTS (Gestion catalogue) -->
    <!-- ========================================== -->
    <section id="products" class="section space-y-6">
      <!-- Header -->
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div>
          <h2 class="text-2xl font-bold text-white">Mes produits</h2>
          <p class="text-slate-400 text-sm mt-1">Gérez votre catalogue produits</p>
        </div>
        <div class="flex gap-3">
          <button onclick="openProductModal()" class="btn-primary px-4 py-2.5 rounded-lg text-sm font-medium flex items-center gap-2">
            <i class="fas fa-plus"></i>
            Ajouter un produit
          </button>
          <button onclick="importProducts()" class="bg-slate-800 hover:bg-slate-700 border border-slate-700 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors">
            <i class="fas fa-upload"></i>
            Importer
          </button>
        </div>
      </div>

      <!-- Filters -->
      <div class="card rounded-xl p-4">
        <div class="flex flex-col md:flex-row gap-4">
          <div class="relative flex-1">
            <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"></i>
            <input type="text" id="product-search" placeholder="Rechercher un produit..." 
                   class="w-full bg-slate-800 border border-slate-700 rounded-lg pl-10 pr-4 py-2.5 text-sm focus:border-indigo-500 outline-none"
                   oninput="filterProducts()">
          </div>
          <select id="product-status-filter" class="bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:border-indigo-500 outline-none" onchange="filterProducts()">
            <option value="">Tous les statuts</option>
            <option value="published">Publié</option>
            <option value="draft">Brouillon</option>
            <option value="archived">Archivé</option>
          </select>
          <select id="product-category-filter" class="bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:border-indigo-500 outline-none" onchange="filterProducts()">
            <option value="">Toutes les catégories</option>
          </select>
        </div>
      </div>

      <!-- Products Grid -->
      <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        <div class="col-span-full text-center py-12">
          <i class="fas fa-spinner fa-spin text-3xl text-indigo-400"></i>
        </div>
      </div>

      <!-- Pagination -->
      <div id="products-pagination" class="flex justify-center gap-2 mt-6 hidden">
        <button onclick="changeProductPage(-1)" class="px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-sm disabled:opacity-50" id="prev-page">
          <i class="fas fa-chevron-left"></i>
        </button>
        <span id="page-info" class="px-4 py-2 text-sm text-slate-400">Page 1 sur 1</span>
        <button onclick="changeProductPage(1)" class="px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-sm disabled:opacity-50" id="next-page">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </section>

    <!-- ========================================== -->
    <!-- SECTION: PROMOTIONS -->
    <!-- ========================================== -->
    <section id="promotions" class="section space-y-6">
      <div class="flex justify-between items-center">
        <div>
          <h2 class="text-2xl font-bold text-white">Promotions</h2>
          <p class="text-slate-400 text-sm mt-1">Créez des offres pour booster vos ventes</p>
        </div>
        <button onclick="openPromotionModal()" class="btn-primary px-4 py-2.5 rounded-lg text-sm font-medium flex items-center gap-2">
          <i class="fas fa-plus"></i>
          Nouvelle promotion
        </button>
      </div>

      <!-- Active Promotions -->
      <div class="card rounded-xl overflow-hidden">
        <div class="p-6 border-b border-slate-800">
          <h3 class="font-semibold text-lg">Promotions actives</h3>
        </div>
        <div id="active-promotions" class="divide-y divide-slate-800">
          <div class="p-8 text-center text-slate-500">
            <i class="fas fa-spinner fa-spin text-3xl mb-4"></i>
            <p>Chargement...</p>
          </div>
        </div>
      </div>

      <!-- Promotion History -->
      <div class="card rounded-xl overflow-hidden">
        <div class="p-6 border-b border-slate-800">
          <h3 class="font-semibold text-lg">Historique</h3>
        </div>
        <div id="promotion-history" class="divide-y divide-slate-800">
          <div class="p-6 text-center text-slate-500">
            <p class="text-sm">Les promotions expirées apparaîtront ici</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ========================================== -->
    <!-- SECTION: ORDERS (Commandes) -->
    <!-- ========================================== -->
    <section id="orders" class="section space-y-6">
      <div>
        <h2 class="text-2xl font-bold text-white">Commandes</h2>
        <p class="text-slate-400 text-sm mt-1">Suivez et gérez vos commandes clients</p>
      </div>

      <!-- Status Tabs -->
      <div class="card rounded-xl p-2">
        <div class="flex gap-2 overflow-x-auto">
          <button onclick="filterOrders('all')" class="order-tab active px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-indigo-600 text-white" data-filter="all">
            Toutes <span class="ml-2 bg-white/20 px-2 py-0.5 rounded-full text-xs" id="count-all">0</span>
          </button>
          <button onclick="filterOrders('pending')" class="order-tab px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap text-slate-400 hover:text-white hover:bg-slate-800 transition-colors" data-filter="pending">
            À préparer <span class="ml-2 bg-slate-700 px-2 py-0.5 rounded-full text-xs" id="count-pending">0</span>
          </button>
          <button onclick="filterOrders('paid')" class="order-tab px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap text-slate-400 hover:text-white hover:bg-slate-800 transition-colors" data-filter="paid">
            Payées <span class="ml-2 bg-slate-700 px-2 py-0.5 rounded-full text-xs" id="count-paid">0</span>
          </button>
          <button onclick="filterOrders('shipped')" class="order-tab px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap text-slate-400 hover:text-white hover:bg-slate-800 transition-colors" data-filter="shipped">
            Expédiées <span class="ml-2 bg-slate-700 px-2 py-0.5 rounded-full text-xs" id="count-shipped">0</span>
          </button>
          <button onclick="filterOrders('delivered')" class="order-tab px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap text-slate-400 hover:text-white hover:bg-slate-800 transition-colors" data-filter="delivered">
            Livrées <span class="ml-2 bg-slate-700 px-2 py-0.5 rounded-full text-xs" id="count-delivered">0</span>
          </button>
        </div>
      </div>

      <!-- Orders List -->
      <div id="orders-list" class="space-y-4">
        <div class="text-center py-12">
          <i class="fas fa-spinner fa-spin text-3xl text-indigo-400"></i>
        </div>
      </div>
    </section>

    <!-- ========================================== -->
    <!-- SECTION: PAYMENTS (Paiements) -->
    <!-- ========================================== -->
    <section id="payments" class="section space-y-6">
      <div>
        <h2 class="text-2xl font-bold text-white">Paiements & Revenus</h2>
        <p class="text-slate-400 text-sm mt-1">Suivez vos revenus et demandez des virements</p>
      </div>

      <!-- Balance Cards -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="card rounded-xl p-6 text-center">
          <div class="w-14 h-14 bg-emerald-500/10 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-check-circle text-emerald-400 text-2xl"></i>
          </div>
          <p class="text-slate-400 text-sm mb-1">Solde disponible</p>
          <p class="text-4xl font-bold text-emerald-400 mb-4" id="balance-available">
            <span class="skeleton w-32 h-10 rounded inline-block"></span>
          </p>
          <button onclick="requestPayout()" id="btn-payout" class="w-full py-2.5 bg-emerald-600 hover:bg-emerald-500 rounded-lg text-sm font-medium text-white transition-colors">
            Demander un virement
          </button>
        </div>

        <div class="card rounded-xl p-6 text-center">
          <div class="w-14 h-14 bg-amber-500/10 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-clock text-amber-400 text-2xl"></i>
          </div>
          <p class="text-slate-400 text-sm mb-1">En attente</p>
          <p class="text-4xl font-bold text-amber-400 mb-4" id="balance-pending">
            <span class="skeleton w-32 h-10 rounded inline-block"></span>
          </p>
          <p class="text-xs text-slate-500">Disponible dans 7 jours</p>
        </div>

        <div class="card rounded-xl p-6 text-center">
          <div class="w-14 h-14 bg-indigo-500/10 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-chart-line text-indigo-400 text-2xl"></i>
          </div>
          <p class="text-slate-400 text-sm mb-1">Total gagné</p>
          <p class="text-4xl font-bold text-indigo-400 mb-4" id="balance-total">
            <span class="skeleton w-32 h-10 rounded inline-block"></span>
          </p>
          <p class="text-xs text-slate-500">Depuis le début</p>
        </div>
      </div>

      <!-- Transactions -->
      <div class="card rounded-xl overflow-hidden">
        <div class="p-6 border-b border-slate-800 flex justify-between items-center">
          <h3 class="font-semibold text-lg">Historique des transactions</h3>
          <button onclick="exportTransactions()" class="text-slate-400 hover:text-white text-sm">
            <i class="fas fa-download mr-1"></i> Exporter
          </button>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead class="bg-slate-800/50 text-slate-400 text-xs uppercase">
              <tr>
                <th class="text-left py-4 px-6 font-semibold">Date</th>
                <th class="text-left py-4 px-6 font-semibold">Description</th>
                <th class="text-right py-4 px-6 font-semibold">Montant</th>
                <th class="text-center py-4 px-6 font-semibold">Statut</th>
              </tr>
            </thead>
            <tbody id="transactions-list" class="divide-y divide-slate-800">
              <tr>
                <td colspan="4" class="py-8 text-center text-slate-500">
                  <i class="fas fa-spinner fa-spin mr-2"></i>Chargement...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Stripe Info -->
      <div class="card rounded-xl p-6">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 bg-indigo-500/10 rounded-lg flex items-center justify-center">
            <i class="fab fa-stripe text-indigo-400 text-2xl"></i>
          </div>
          <div class="flex-1">
            <h4 class="font-semibold">Compte Stripe Connect</h4>
            <p class="text-sm text-slate-400">Statut: <span id="stripe-status" class="text-emerald-400">Vérification...</span></p>
          </div>
          <button onclick="manageStripeAccount()" class="px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-sm transition-colors">
            Gérer
          </button>
        </div>
      </div>
    </section>

    <!-- ========================================== -->
    <!-- SECTION: ANALYTICS (Statistiques) -->
    <!-- ========================================== -->
    <section id="analytics" class="section space-y-6">
      <div>
        <h2 class="text-2xl font-bold text-white">Statistiques</h2>
        <p class="text-slate-400 text-sm mt-1">Analysez votre performance commerciale</p>
      </div>

      <!-- Period Selector -->
      <div class="flex gap-2">
        <button onclick="updateAnalyticsPeriod(7)" class="analytics-period px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium" data-period="7">7 jours</button>
        <button onclick="updateAnalyticsPeriod(30)" class="analytics-period px-4 py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg text-sm font-medium transition-colors" data-period="30">30 jours</button>
        <button onclick="updateAnalyticsPeriod('month')" class="analytics-period px-4 py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg text-sm font-medium transition-colors" data-period="month">Ce mois</button>
        <button onclick="updateAnalyticsPeriod('year')" class="analytics-period px-4 py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg text-sm font-medium transition-colors" data-period="year">Cette année</button>
      </div>

      <!-- Charts Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Sales Chart -->
        <div class="card rounded-xl p-6">
          <h3 class="font-semibold text-lg mb-4">Ventes</h3>
          <div class="chart-container">
            <canvas id="analyticsSalesChart"></canvas>
          </div>
        </div>

        <!-- Conversion Chart -->
        <div class="card rounded-xl p-6">
          <h3 class="font-semibold text-lg mb-4">Taux de conversion</h3>
          <div class="chart-container">
            <canvas id="conversionChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Detailed Stats -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="detailed-stats">
        <div class="card rounded-xl p-6">
          <p class="text-slate-400 text-sm">Panier moyen</p>
          <p class="text-3xl font-bold text-white mt-2" id="stat-avg-cart">
            <span class="skeleton w-24 h-8 rounded inline-block"></span>
          </p>
          <p class="text-xs text-emerald-400 mt-1" id="stat-avg-cart-trend">--</p>
        </div>
        <div class="card rounded-xl p-6">
          <p class="text-slate-400 text-sm">Taux de conversion</p>
          <p class="text-3xl font-bold text-white mt-2" id="stat-conversion">
            <span class="skeleton w-24 h-8 rounded inline-block"></span>
          </p>
          <p class="text-xs text-emerald-400 mt-1" id="stat-conversion-trend">--</p>
        </div>
        <div class="card rounded-xl p-6">
          <p class="text-slate-400 text-sm">Clients récurrents</p>
          <p class="text-3xl font-bold text-white mt-2" id="stat-returning">
            <span class="skeleton w-24 h-8 rounded inline-block"></span>
          </p>
          <p class="text-xs text-amber-400 mt-1" id="stat-returning-trend">--</p>
        </div>
      </div>
    </section>

    <!-- ========================================== -->
    <!-- SECTION: PROFILE (Profil marque) -->
    <!-- ========================================== -->
    <section id="profile" class="section space-y-6">
      <div>
        <h2 class="text-2xl font-bold text-white">Profil de la marque</h2>
        <p class="text-slate-400 text-sm mt-1">Gérez votre identité publique</p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Info -->
        <div class="lg:col-span-2 space-y-6">
          <!-- Brand Card -->
          <div class="card rounded-xl p-6">
            <div class="flex items-start gap-6 mb-6">
              <div class="relative">
                <div class="w-24 h-24 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg overflow-hidden" id="brand-logo-container">
                  <i class="fas fa-building text-white text-3xl" id="brand-logo-icon"></i>
                  <img id="brand-logo-img" class="w-full h-full object-cover hidden" alt="Logo">
                </div>
                <input type="file" id="logo-upload" accept="image/*" class="hidden" onchange="handleLogoUpload(event)">
                <button onclick="document.getElementById('logo-upload').click()" class="absolute -bottom-2 -right-2 w-8 h-8 bg-slate-700 hover:bg-slate-600 rounded-full flex items-center justify-center border-2 border-slate-800 transition-colors">
                  <i class="fas fa-camera text-xs"></i>
                </button>
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                  <h3 class="text-xl font-bold" id="brand-name">Chargement...</h3>
                  <span class="badge badge-published text-xs" id="brand-verified">Vérifié</span>
                </div>
                <p class="text-slate-400 text-sm mb-4" id="brand-category">--</p>
                <div class="flex gap-3">
                  <button onclick="editBrand()" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-500 rounded-lg text-sm font-medium transition-colors">
                    Modifier
                  </button>
                  <button onclick="viewPublicProfile()" class="px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-sm transition-colors">
                    Voir la boutique
                  </button>
                </div>
              </div>
            </div>

            <form id="brand-form" class="space-y-4 hidden">
              <div>
                <label class="block text-sm text-slate-400 mb-1.5">Nom de la marque *</label>
                <input type="text" id="edit-brand-name" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:border-indigo-500 outline-none">
              </div>
              <div>
                <label class="block text-sm text-slate-400 mb-1.5">Description</label>
                <textarea id="edit-brand-description" rows="4" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:border-indigo-500 outline-none resize-none"></textarea>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm text-slate-400 mb-1.5">Site web</label>
                  <input type="url" id="edit-brand-website" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:border-indigo-500 outline-none">
                </div>
                <div>
                  <label class="block text-sm text-slate-400 mb-1.5">Email contact</label>
                  <input type="email" id="edit-brand-email" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:border-indigo-500 outline-none">
                </div>
              </div>
              <div>
                <label class="block text-sm text-slate-400 mb-1.5">Catégorie principale</label>
                <select id="edit-brand-category" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:border-indigo-500 outline-none">
                  <option value="">Choisir une catégorie...</option>
                </select>
              </div>
              <div class="flex gap-3 pt-2">
                <button type="button" onclick="saveBrand()" class="px-6 py-2.5 bg-indigo-600 hover:bg-indigo-500 rounded-lg text-sm font-medium transition-colors">
                  Enregistrer
                </button>
                <button type="button" onclick="cancelEditBrand()" class="px-6 py-2.5 bg-slate-800 hover:bg-slate-700 rounded-lg text-sm transition-colors">
                  Annuler
                </button>
              </div>
            </form>

            <div id="brand-display" class="space-y-4">
              <div>
                <label class="block text-xs text-slate-500 uppercase tracking-wider mb-1">Description</label>
                <p class="text-slate-300 text-sm leading-relaxed" id="brand-description">
                  Chargement...
                </p>
              </div>
              <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <label class="block text-xs text-slate-500 uppercase tracking-wider mb-1">Site web</label>
                  <a href="#" class="text-indigo-400 hover:text-indigo-300" id="brand-website">--</a>
                </div>
                <div>
                  <label class="block text-xs text-slate-500 uppercase tracking-wider mb-1">Email</label>
                  <span class="text-slate-300" id="brand-email">--</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Address -->
          <div class="card rounded-xl p-6">
            <div class="flex justify-between items-center mb-4">
              <h4 class="font-semibold">Adresse</h4>
              <button onclick="editAddress()" class="text-indigo-400 hover:text-indigo-300 text-sm">
                <i class="fas fa-edit mr-1"></i>Modifier
              </button>
            </div>
            <div id="address-display" class="grid grid-cols-2 gap-4 text-sm">
              <div class="col-span-2">
                <label class="block text-xs text-slate-500 uppercase tracking-wider mb-1">Rue</label>
                <p class="text-slate-300" id="address-street">--</p>
              </div>
              <div>
                <label class="block text-xs text-slate-500 uppercase tracking-wider mb-1">Ville</label>
                <p class="text-slate-300" id="address-city">--</p>
              </div>
              <div>
                <label class="block text-xs text-slate-500 uppercase tracking-wider mb-1">Code postal</label>
                <p class="text-slate-300" id="address-postal">--</p>
              </div>
              <div>
                <label class="block text-xs text-slate-500 uppercase tracking-wider mb-1">Pays</label>
                <p class="text-slate-300" id="address-country">--</p>
              </div>
            </div>
            <form id="address-form" class="space-y-4 hidden">
              <div>
                <label class="block text-sm text-slate-400 mb-1.5">Adresse</label>
                <input type="text" id="edit-address-street" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:border-indigo-500 outline-none">
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm text-slate-400 mb-1.5">Ville</label>
                  <input type="text" id="edit-address-city" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:border-indigo-500 outline-none">
                </div>
                <div>
                  <label class="block text-sm text-slate-400 mb-1.5">Code postal</label>
                  <input type="text" id="edit-address-postal" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:border-indigo-500 outline-none">
                </div>
              </div>
              <div>
                <label class="block text-sm text-slate-400 mb-1.5">Pays</label>
                <select id="edit-address-country" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:border-indigo-500 outline-none">
                  <!-- Rempli dynamiquement -->
                </select>
              </div>
              <div class="flex gap-3">
                <button type="button" onclick="saveAddress()" class="px-6 py-2.5 bg-indigo-600 hover:bg-indigo-500 rounded-lg text-sm font-medium transition-colors">
                  Enregistrer
                </button>
                <button type="button" onclick="cancelEditAddress()" class="px-6 py-2.5 bg-slate-800 hover:bg-slate-700 rounded-lg text-sm transition-colors">
                  Annuler
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Sidebar Info -->
        <div class="space-y-6">
          <!-- Social Media -->
          <div class="card rounded-xl p-6">
            <h4 class="font-semibold mb-4">Réseaux sociaux</h4>
            <div class="space-y-3">
              <div class="flex items-center gap-3">
                <i class="fab fa-instagram text-pink-500 w-5"></i>
                <input type="text" id="social-instagram" placeholder="@votrecompte" 
                       class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:border-indigo-500 outline-none">
              </div>
              <div class="flex items-center gap-3">
                <i class="fab fa-facebook text-blue-500 w-5"></i>
                <input type="text" id="social-facebook" placeholder="Facebook" 
                       class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:border-indigo-500 outline-none">
              </div>
              <div class="flex items-center gap-3">
                <i class="fab fa-tiktok text-white w-5"></i>
                <input type="text" id="social-tiktok" placeholder="TikTok" 
                       class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:border-indigo-500 outline-none">
              </div>
              <div class="flex items-center gap-3">
                <i class="fab fa-linkedin text-blue-600 w-5"></i>
                <input type="text" id="social-linkedin" placeholder="LinkedIn" 
                       class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:border-indigo-500 outline-none">
              </div>
            </div>
            <button onclick="saveSocialMedia()" class="w-full mt-4 py-2 bg-indigo-600 hover:bg-indigo-500 rounded-lg text-sm font-medium transition-colors">
              Enregistrer
            </button>
          </div>

          <!-- Legal Info -->
          <div class="card rounded-xl p-6">
            <h4 class="font-semibold mb-4">Informations légales</h4>
            <div class="space-y-3 text-sm">
              <div>
                <label class="block text-xs text-slate-500 uppercase tracking-wider mb-1">SIRET</label>
                <p class="text-slate-300" id="legal-siret">--</p>
              </div>
              <div>
                <label class="block text-xs text-slate-500 uppercase tracking-wider mb-1">TVA</label>
                <p class="text-slate-300" id="legal-vat">--</p>
              </div>
              <div>
                <label class="block text-xs text-slate-500 uppercase tracking-wider mb-1">Forme juridique</label>
                <p class="text-slate-300" id="legal-form">--</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ========================================== -->
    <!-- SECTION: SUPPORT -->
    <!-- ========================================== -->
    <section id="support" class="section space-y-6">
      <div>
        <h2 class="text-2xl font-bold text-white">Support & Aide</h2>
        <p class="text-slate-400 text-sm mt-1">Nous sommes là pour vous aider</p>
      </div>

      <!-- Support Options -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="card rounded-xl p-6 hover:border-indigo-500/30 transition-colors cursor-pointer group" onclick="openTicketModal()">
          <div class="w-14 h-14 bg-indigo-500/10 rounded-xl flex items-center justify-center mb-4 group-hover:bg-indigo-500/20 transition-colors">
            <i class="fas fa-ticket-alt text-2xl text-indigo-400"></i>
          </div>
          <h3 class="font-semibold text-lg mb-2">Créer un ticket</h3>
          <p class="text-slate-400 text-sm mb-4">Une question ou un problème ? Notre équipe vous répond sous 24h ouvrées.</p>
          <span class="text-indigo-400 group-hover:translate-x-1 transition-transform inline-flex items-center gap-1 text-sm font-medium">
            Ouvrir un ticket <i class="fas fa-arrow-right"></i>
          </span>
        </div>

        <div class="card rounded-xl p-6 hover:border-purple-500/30 transition-colors cursor-pointer group">
          <div class="w-14 h-14 bg-purple-500/10 rounded-xl flex items-center justify-center mb-4 group-hover:bg-purple-500/20 transition-colors">
            <i class="fas fa-book text-2xl text-purple-400"></i>
          </div>
          <h3 class="font-semibold text-lg mb-2">Guide du vendeur</h3>
          <p class="text-slate-400 text-sm mb-4">Tout savoir pour vendre sur Brandia : conseils, bonnes pratiques et astuces.</p>
          <a href="#" class="text-purple-400 hover:text-purple-300 text-sm font-medium group-hover:translate-x-1 transition-transform inline-flex items-center gap-1">
            Consulter le guide <i class="fas fa-arrow-right"></i>
          </a>
        </div>
      </div>

      <!-- FAQ -->
      <div class="card rounded-xl p-6">
        <h3 class="font-semibold text-lg mb-6">Questions fréquentes</h3>
        <div class="space-y-3" id="faq-list">
          <details class="group">
            <summary class="flex justify-between items-center cursor-pointer list-none p-4 bg-slate-800/50 rounded-lg hover:bg-slate-800 transition-colors">
              <span class="font-medium text-sm">Comment ajouter un produit ?</span>
              <i class="fas fa-chevron-down text-slate-500 group-open:rotate-180 transition-transform"></i>
            </summary>
            <p class="mt-3 text-slate-400 text-sm px-4 pb-2">
              Rendez-vous dans la section "Produits" et cliquez sur "Ajouter un produit". Remplissez les informations requises et publiez.
            </p>
          </details>
          
          <details class="group">
            <summary class="flex justify-between items-center cursor-pointer list-none p-4 bg-slate-800/50 rounded-lg hover:bg-slate-800 transition-colors">
              <span class="font-medium text-sm">Quand suis-je payé ?</span>
              <i class="fas fa-chevron-down text-slate-500 group-open:rotate-180 transition-transform"></i>
            </summary>
            <p class="mt-3 text-slate-400 text-sm px-4 pb-2">
              Les paiements sont effectués 7 jours après la livraison confirmée de la commande. Vous pouvez demander un virement dès que votre solde est disponible.
            </p>
          </details>
          
          <details class="group">
            <summary class="flex justify-between items-center cursor-pointer list-none p-4 bg-slate-800/50 rounded-lg hover:bg-slate-800 transition-colors">
              <span class="font-medium text-sm">Comment fonctionne la commission ?</span>
              <i class="fas fa-chevron-down text-slate-500 group-open:rotate-180 transition-transform"></i>
            </summary>
            <p class="mt-3 text-slate-400 text-sm px-4 pb-2">
              Brandia prélève une commission de 15% sur chaque vente. Ce pourcentage est automatiquement déduit avant le versement sur votre compte Stripe.
            </p>
          </details>
        </div>
      </div>

      <!-- Contact -->
      <div class="card rounded-xl p-6">
        <h3 class="font-semibold text-lg mb-4">Contact direct</h3>
        <div class="flex flex-col md:flex-row gap-6 text-sm">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-slate-800 rounded-lg flex items-center justify-center">
              <i class="fas fa-envelope text-slate-400"></i>
            </div>
            <div>
              <p class="text-slate-500">Email</p>
              <a href="mailto:support@brandia.com" class="text-indigo-400 hover:text-indigo-300">support@brandia.com</a>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-slate-800 rounded-lg flex items-center justify-center">
              <i class="fas fa-phone text-slate-400"></i>
            </div>
            <div>
              <p class="text-slate-500">Téléphone</p>
              <span class="text-slate-300">+33 1 23 45 67 89</span>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-slate-800 rounded-lg flex items-center justify-center">
              <i class="fas fa-clock text-slate-400"></i>
            </div>
            <div>
              <p class="text-slate-500">Horaires</p>
              <span class="text-slate-300">Lun-Ven, 9h-18h</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ========================================== -->
    <!-- SECTION: SETTINGS (Paramètres) -->
    <!-- ========================================== -->
    <section id="settings" class="section space-y-6">
      <div>
        <h2 class="text-2xl font-bold text-white">Paramètres</h2>
        <p class="text-slate-400 text-sm mt-1">Gérez vos préférences et sécurité</p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Account Settings -->
        <div class="card rounded-xl p-6">
          <h3 class="font-semibold text-lg mb-6 flex items-center gap-2">
            <i class="fas fa-user-circle text-indigo-400"></i>
            Compte
          </h3>
          
          <div class="space-y-6">
            <div>
              <label class="block text-sm text-slate-400 mb-3">Langue</label>
              <select id="setting-language" onchange="updateSetting('language', this.value)" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:border-indigo-500 outline-none">
                <option value="fr">🇫🇷 Français</option>
                <option value="en">🇬🇧 English</option>
                <option value="de">🇩🇪 Deutsch</option>
                <option value="es">🇪🇸 Español</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm text-slate-400 mb-3">Fuseau horaire</label>
              <select id="setting-timezone" onchange="updateSetting('timezone', this.value)" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:border-indigo-500 outline-none">
                <option value="Europe/Paris">Europe/Paris (UTC+1)</option>
                <option value="Europe/London">Europe/London (UTC+0)</option>
                <option value="Europe/Berlin">Europe/Berlin (UTC+1)</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm text-slate-400 mb-3">Devise</label>
              <select id="setting-currency" onchange="updateSetting('currency', this.value)" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:border-indigo-500 outline-none">
                <option value="EUR">EUR (€)</option>
                <option value="USD">USD ($)</option>
                <option value="GBP">GBP (£)</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Notifications -->
        <div class="card rounded-xl p-6">
          <h3 class="font-semibold text-lg mb-6 flex items-center gap-2">
            <i class="fas fa-bell text-indigo-400"></i>
            Notifications
          </h3>
          
          <div class="space-y-4">
            <label class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg cursor-pointer hover:bg-slate-800 transition-colors">
              <div>
                <p class="font-medium text-sm">Nouvelles commandes</p>
                <p class="text-xs text-slate-500">Recevoir un email</p>
              </div>
              <input type="checkbox" id="notif-orders" onchange="updateNotification('orders', this.checked)" checked class="toggle">
            </label>
            
            <label class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg cursor-pointer hover:bg-slate-800 transition-colors">
              <div>
                <p class="font-medium text-sm">Paiements reçus</p>
                <p class="text-xs text-slate-500">Recevoir un email</p>
              </div>
              <input type="checkbox" id="notif-payments" onchange="updateNotification('payments', this.checked)" checked class="toggle">
            </label>
            
            <label class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg cursor-pointer hover:bg-slate-800 transition-colors">
              <div>
                <p class="font-medium text-sm">Messages clients</p>
                <p class="text-xs text-slate-500">Recevoir un email</p>
              </div>
              <input type="checkbox" id="notif-messages" onchange="updateNotification('messages', this.checked)" class="toggle">
            </label>
            
            <label class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg cursor-pointer hover:bg-slate-800 transition-colors">
              <div>
                <p class="font-medium text-sm">Promotions expirant</p>
                <p class="text-xs text-slate-500">Notification 3 jours avant</p>
              </div>
              <input type="checkbox" id="notif-promotions" onchange="updateNotification('promotions', this.checked)" checked class="toggle">
            </label>
          </div>
        </div>

        <!-- Security -->
        <div class="card rounded-xl p-6">
          <h3 class="font-semibold text-lg mb-6 flex items-center gap-2">
            <i class="fas fa-shield-alt text-indigo-400"></i>
            Sécurité
          </h3>
          
          <div class="space-y-4">
            <button onclick="changePassword()" class="w-full flex justify-between items-center p-3 bg-slate-800/50 rounded-lg hover:bg-slate-800 transition-colors text-left group">
              <div>
                <p class="font-medium text-sm">Mot de passe</p>
                <p class="text-xs text-slate-500">Dernière modification il y a 3 mois</p>
              </div>
              <i class="fas fa-chevron-right text-slate-500 group-hover:text-white transition-colors"></i>
            </button>
            
            <button onclick="setup2FA()" class="w-full flex justify-between items-center p-3 bg-slate-800/50 rounded-lg hover:bg-slate-800 transition-colors text-left group">
              <div>
                <p class="font-medium text-sm">Authentification à deux facteurs</p>
                <p class="text-xs text-slate-500" id="2fa-status">Non activée</p>
              </div>
              <span class="text-xs bg-amber-500/20 text-amber-400 px-2 py-1 rounded" id="2fa-badge">Activer</span>
            </button>
            
            <button onclick="manageSessions()" class="w-full flex justify-between items-center p-3 bg-slate-800/50 rounded-lg hover:bg-slate-800 transition-colors text-left group">
              <div>
                <p class="font-medium text-sm">Sessions actives</p>
                <p class="text-xs text-slate-500" id="active-sessions">Chargement...</p>
              </div>
              <i class="fas fa-chevron-right text-slate-500 group-hover:text-white transition-colors"></i>
            </button>
          </div>
        </div>

        <!-- Danger Zone -->
        <div class="card rounded-xl p-6 border-red-500/20">
          <h3 class="font-semibold text-lg mb-6 flex items-center gap-2 text-red-400">
            <i class="fas fa-exclamation-triangle"></i>
            Zone de danger
          </h3>
          
          <div class="space-y-4">
            <div class="flex justify-between items-center">
              <div>
                <p class="font-medium text-sm">Désactiver la boutique</p>
                <p class="text-xs text-slate-500">Vos produits ne seront plus visibles</p>
              </div>
              <button onclick="toggleShopStatus()" id="btn-toggle-shop" class="px-4 py-2 bg-red-500/10 text-red-400 hover:bg-red-500/20 rounded-lg text-sm font-medium transition-colors">
                Désactiver
              </button>
            </div>
            
            <div class="flex justify-between items-center pt-4 border-t border-slate-800">
              <div>
                <p class="font-medium text-sm text-red-400">Supprimer le compte</p>
                <p class="text-xs text-slate-500">Cette action est irréversible</p>
              </div>
              <button onclick="deleteAccount()" class="px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg text-sm font-medium transition-colors">
                Supprimer
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

  </div>
</main>

<!-- ========================================== -->
<!-- MODALS -->
<!-- ========================================== -->

<!-- Product Modal -->
<div id="product-modal" class="fixed inset-0 z-50 hidden">
  <div class="modal-backdrop absolute inset-0" onclick="closeModal('product-modal')"></div>
  <div class="absolute inset-4 md:inset-10 bg-slate-900 rounded-2xl border border-slate-700 shadow-2xl overflow-hidden flex flex-col max-w-5xl mx-auto">
    <div class="p-6 border-b border-slate-800 flex justify-between items-center">
      <h3 class="text-xl font-bold" id="product-modal-title">Ajouter un produit</h3>
      <button onclick="closeModal('product-modal')" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-slate-800 text-slate-400 hover:text-white transition-colors">
        <i class="fas fa-times text-lg"></i>
      </button>
    </div>
    
    <form id="product-form" class="flex-1 overflow-y-auto p-6">
      <input type="hidden" id="product-id" name="id">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Left Column -->
        <div class="space-y-6">
          <div>
            <label class="block text-sm text-slate-400 mb-2">Nom du produit <span class="text-red-400">*</span></label>
            <input type="text" name="name" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none" placeholder="Ex: Sérum Hydratant">
          </div>
          
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm text-slate-400 mb-2">Référence / SKU</label>
              <input type="text" name="sku" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none" placeholder="REF-001">
            </div>
            <div>
              <label class="block text-sm text-slate-400 mb-2">Catégorie <span class="text-red-400">*</span></label>
              <select name="category_id" id="product-category-select" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none">
                <option value="">Choisir...</option>
              </select>
            </div>
          </div>

          <div class="grid grid-cols-3 gap-4">
            <div>
              <label class="block text-sm text-slate-400 mb-2">Prix (€) <span class="text-red-400">*</span></label>
              <input type="number" name="price" step="0.01" min="0" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none" placeholder="29.99">
            </div>
            <div>
              <label class="block text-sm text-slate-400 mb-2">Prix promo</label>
              <input type="number" name="compare_price" step="0.01" min="0" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none" placeholder="39.99">
            </div>
            <div>
              <label class="block text-sm text-slate-400 mb-2">Stock <span class="text-red-400">*</span></label>
              <input type="number" name="stock_quantity" min="0" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none" placeholder="100">
            </div>
          </div>

          <div>
            <label class="block text-sm text-slate-400 mb-2">Description courte</label>
            <input type="text" name="short_description" maxlength="150" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none" placeholder="Description rapide pour les listes...">
          </div>

          <div>
            <label class="block text-sm text-slate-400 mb-2">Description détaillée</label>
            <textarea name="description" rows="4" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none resize-none" placeholder="Description complète du produit..."></textarea>
          </div>
        </div>

        <!-- Right Column -->
        <div class="space-y-6">
          <div>
            <label class="block text-sm text-slate-400 mb-2">Images du produit</label>
            <div class="border-2 border-dashed border-slate-700 rounded-lg p-8 text-center hover:border-indigo-500/50 transition-colors cursor-pointer relative" onclick="document.getElementById('product-images').click()" id="drop-zone">
              <div id="upload-placeholder">
                <i class="fas fa-cloud-upload-alt text-3xl text-slate-500 mb-3"></i>
                <p class="text-slate-400 text-sm">Cliquez ou glissez vos images ici</p>
                <p class="text-slate-500 text-xs mt-1">JPG, PNG jusqu'à 5MB</p>
              </div>
              <div id="image-previews" class="grid grid-cols-3 gap-2 hidden"></div>
            </div>
            <input type="file" id="product-images" multiple accept="image/*" class="hidden" onchange="handleImageUpload(event)">
            <p class="text-xs text-slate-500 mt-2" id="upload-status"></p>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm text-slate-400 mb-2">Poids (kg)</label>
              <input type="number" name="weight" step="0.01" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none" placeholder="0.5">
            </div>
            <div>
              <label class="block text-sm text-slate-400 mb-2">Dimensions (cm)</label>
              <input type="text" name="dimensions" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none" placeholder="L x l x H">
            </div>
          </div>

          <div>
            <label class="block text-sm text-slate-400 mb-2">Statut</label>
            <div class="flex gap-4">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="status" value="draft" class="text-indigo-600 bg-slate-800 border-slate-700">
                <span class="text-sm">Brouillon</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="status" value="published" checked class="text-indigo-600 bg-slate-800 border-slate-700">
                <span class="text-sm">Publié</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="status" value="archived" class="text-indigo-600 bg-slate-800 border-slate-700">
                <span class="text-sm">Archivé</span>
              </label>
            </div>
          </div>

          <div>
            <label class="block text-sm text-slate-400 mb-2">Caractéristiques</label>
            <div id="features-container" class="space-y-2">
              <div class="flex gap-2 feature-row">
                <input type="text" name="feature_name[]" placeholder="Nom (ex: Matière)" class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:border-indigo-500 outline-none">
                <input type="text" name="feature_value[]" placeholder="Valeur (ex: Coton)" class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:border-indigo-500 outline-none">
                <button type="button" onclick="removeFeature(this)" class="text-red-400 hover:text-red-300 px-2">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            <button type="button" onclick="addFeature()" class="text-indigo-400 hover:text-indigo-300 text-sm mt-2">
              <i class="fas fa-plus mr-1"></i> Ajouter une caractéristique
            </button>
          </div>
        </div>
      </div>
    </form>

    <div class="p-6 border-t border-slate-800 bg-slate-900 flex justify-end gap-3">
      <button type="button" onclick="closeModal('product-modal')" class="px-6 py-2.5 text-slate-400 hover:text-white transition-colors">
        Annuler
      </button>
      <button type="button" onclick="saveProduct()" id="btn-save-product" class="btn-primary px-6 py-2.5 rounded-lg font-medium flex items-center gap-2">
        <i class="fas fa-spinner fa-spin hidden" id="save-product-spinner"></i>
        <span>Enregistrer le produit</span>
      </button>
    </div>
  </div>
</div>

<!-- Promotion Modal -->
<div id="promotion-modal" class="fixed inset-0 z-50 hidden">
  <div class="modal-backdrop absolute inset-0" onclick="closeModal('promotion-modal')"></div>
  <div class="absolute inset-4 md:inset-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 bg-slate-900 rounded-2xl border border-slate-700 shadow-2xl w-full max-w-lg p-6">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-xl font-bold">Nouvelle promotion</h3>
      <button onclick="closeModal('promotion-modal')" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-slate-800 text-slate-400 hover:text-white transition-colors">
        <i class="fas fa-times text-lg"></i>
      </button>
    </div>

    <form id="promotion-form" class="space-y-5">
      <div>
        <label class="block text-sm text-slate-400 mb-2">Nom de la promotion *</label>
        <input type="text" name="name" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none" placeholder="Soldes d'hiver">
      </div>

      <div>
        <label class="block text-sm text-slate-400 mb-2">Type de remise *</label>
        <div class="grid grid-cols-3 gap-3">
          <label class="flex flex-col items-center gap-2 p-4 bg-slate-800 border border-slate-700 rounded-lg cursor-pointer hover:border-indigo-500/50 transition-colors has-[:checked]:border-indigo-500 has-[:checked]:bg-indigo-500/10">
            <input type="radio" name="type" value="percentage" checked class="hidden">
            <i class="fas fa-percent text-indigo-400"></i>
            <span class="text-xs">Pourcentage</span>
          </label>
          <label class="flex flex-col items-center gap-2 p-4 bg-slate-800 border border-slate-700 rounded-lg cursor-pointer hover:border-indigo-500/50 transition-colors has-[:checked]:border-indigo-500 has-[:checked]:bg-indigo-500/10">
            <input type="radio" name="type" value="fixed" class="hidden">
            <i class="fas fa-euro-sign text-indigo-400"></i>
            <span class="text-xs">Montant fixe</span>
          </label>
          <label class="flex flex-col items-center gap-2 p-4 bg-slate-800 border border-slate-700 rounded-lg cursor-pointer hover:border-indigo-500/50 transition-colors has-[:checked]:border-indigo-500 has-[:checked]:bg-indigo-500/10">
            <input type="radio" name="type" value="bogo" class="hidden">
            <i class="fas fa-gift text-indigo-400"></i>
            <span class="text-xs">Offre spéciale</span>
          </label>
        </div>
      </div>

      <div>
        <label class="block text-sm text-slate-400 mb-2">Valeur *</label>
        <div class="relative">
          <input type="number" name="value" step="0.01" min="0" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none" placeholder="20">
          <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-500" id="promo-value-suffix">%</span>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-slate-400 mb-2">Date début *</label>
          <input type="date" name="start_date" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none">
        </div>
        <div>
          <label class="block text-sm text-slate-400 mb-2">Date fin *</label>
          <input type="date" name="end_date" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none">
        </div>
      </div>

      <div>
        <label class="block text-sm text-slate-400 mb-2">Produits concernés</label>
        <select name="applies_to" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none">
          <option value="all">Tous les produits</option>
          <option value="category">Une catégorie</option>
          <option value="products">Sélection manuelle</option>
        </select>
      </div>
    </form>

    <div class="mt-6 pt-6 border-t border-slate-800 flex justify-end gap-3">
      <button type="button" onclick="closeModal('promotion-modal')" class="px-6 py-2.5 text-slate-400 hover:text-white transition-colors">
        Annuler
      </button>
      <button type="button" onclick="savePromotion()" id="btn-save-promotion" class="btn-primary px-6 py-2.5 rounded-lg font-medium flex items-center gap-2">
        <i class="fas fa-spinner fa-spin hidden" id="save-promo-spinner"></i>
        <span>Créer la promotion</span>
      </button>
    </div>
  </div>
</div>

<!-- Order Detail Modal -->
<div id="order-modal" class="fixed inset-0 z-50 hidden">
  <div class="modal-backdrop absolute inset-0" onclick="closeModal('order-modal')"></div>
  <div class="absolute inset-4 md:inset-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 bg-slate-900 rounded-2xl border border-slate-700 shadow-2xl w-full max-w-2xl p-6 max-h-[90vh] overflow-y-auto">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-xl font-bold">Détail de la commande <span id="order-detail-number">#---</span></h3>
      <button onclick="closeModal('order-modal')" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-slate-800 text-slate-400 hover:text-white transition-colors">
        <i class="fas fa-times text-lg"></i>
      </button>
    </div>

    <div id="order-detail-content" class="space-y-6">
      <!-- Contenu chargé dynamiquement -->
    </div>

    <div class="mt-6 pt-6 border-t border-slate-800 flex justify-end gap-3" id="order-actions">
      <!-- Actions dynamiques selon le statut -->
    </div>
  </div>
</div>

<!-- Ticket Modal -->
<div id="ticket-modal" class="fixed inset-0 z-50 hidden">
  <div class="modal-backdrop absolute inset-0" onclick="closeModal('ticket-modal')"></div>
  <div class="absolute inset-4 md:inset-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 bg-slate-900 rounded-2xl border border-slate-700 shadow-2xl w-full max-w-lg p-6">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-xl font-bold">Nouveau ticket de support</h3>
      <button onclick="closeModal('ticket-modal')" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-slate-800 text-slate-400 hover:text-white transition-colors">
        <i class="fas fa-times text-lg"></i>
      </button>
    </div>

    <form id="ticket-form" class="space-y-5">
      <div>
        <label class="block text-sm text-slate-400 mb-2">Sujet *</label>
        <input type="text" name="subject" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none" placeholder="Problème avec...">
      </div>

      <div>
        <label class="block text-sm text-slate-400 mb-2">Catégorie *</label>
        <select name="category" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none">
          <option value="">Choisir une catégorie...</option>
          <option value="technical">Problème technique</option>
          <option value="payment">Paiement</option>
          <option value="order">Commande</option>
          <option value="product">Produit</option>
          <option value="account">Compte</option>
          <option value="other">Autre</option>
        </select>
      </div>

      <div>
        <label class="block text-sm text-slate-400 mb-2">Message *</label>
        <textarea name="message" required rows="5" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none resize-none" placeholder="Décrivez votre problème en détail..."></textarea>
      </div>

      <div>
        <label class="block text-sm text-slate-400 mb-2">Pièce jointe (optionnel)</label>
        <div class="border-2 border-dashed border-slate-700 rounded-lg p-4 text-center hover:border-indigo-500/50 transition-colors cursor-pointer" onclick="document.getElementById('ticket-attachment').click()">
          <i class="fas fa-paperclip text-slate-500 mb-2"></i>
          <p class="text-slate-400 text-sm">Cliquez pour ajouter un fichier</p>
          <p class="text-xs text-slate-500 mt-1" id="ticket-file-name"></p>
        </div>
        <input type="file" id="ticket-attachment" class="hidden" onchange="handleTicketAttachment(event)">
      </div>
    </form>

    <div class="mt-6 pt-6 border-t border-slate-800 flex justify-end gap-3">
      <button type="button" onclick="closeModal('ticket-modal')" class="px-6 py-2.5 text-slate-400 hover:text-white transition-colors">
        Annuler
      </button>
      <button type="button" onclick="submitTicket()" id="btn-submit-ticket" class="btn-primary px-6 py-2.5 rounded-lg font-medium flex items-center gap-2">
        <i class="fas fa-spinner fa-spin hidden" id="ticket-spinner"></i>
        <span>Envoyer le ticket</span>
      </button>
    </div>
  </div>
</div>

<!-- Toast Notifications -->
<div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

<!-- Loading Overlay -->
<div id="loading-overlay" class="fixed inset-0 z-[60] bg-slate-900/80 backdrop-blur flex items-center justify-center hidden">
  <div class="text-center">
    <i class="fas fa-spinner fa-spin text-4xl text-indigo-400 mb-4"></i>
    <p class="text-slate-300">Chargement...</p>
  </div>
</div>

<!-- Scripts -->
<script src="../assets/js/api.js"></script>
<script>
// ==========================================
// CONFIGURATION & ÉTAT GLOBAL
// ==========================================

const CONFIG = {
  API_BASE_URL: 'http://localhost:4000/api',
  ITEMS_PER_PAGE: 12,
  COMMISSION_RATE: 0.15
};

let currentState = {
  products: [],
  orders: [],
  promotions: [],
  categories: [],
  currentProductPage: 1,
  currentOrderFilter: 'all',
  currentAnalyticsPeriod: 7,
  charts: {}
};

// ==========================================
// NAVIGATION
// ==========================================

function navigate(section) {
  // Masquer toutes les sections
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  
  // Afficher la section cible
  const target = document.getElementById(section);
  if (target) {
    target.classList.add('active');
  }
  
  // Mettre à jour la navigation
  document.querySelectorAll('.nav-link').forEach(l => {
    l.classList.remove('active');
    l.classList.add('text-slate-400');
  });
  
  const activeNav = document.getElementById('nav-' + section);
  if (activeNav) {
    activeNav.classList.add('active');
    activeNav.classList.remove('text-slate-400');
  }
  
  // Mettre à jour le header
  updateHeader(section);
  
  // Charger les données de la section
  loadSectionData(section);
  
  // Scroll en haut
  window.scrollTo(0, 0);
}

function updateHeader(section) {
  const titles = {
    overview: { title: 'Tableau de bord', subtitle: 'Vue d\'ensemble de votre activité' },
    products: { title: 'Mes produits', subtitle: 'Gérez votre catalogue produits' },
    promotions: { title: 'Promotions', subtitle: 'Créez des offres pour booster vos ventes' },
    orders: { title: 'Commandes', subtitle: 'Suivez et gérez vos commandes clients' },
    payments: { title: 'Paiements & Revenus', subtitle: 'Suivez vos revenus et demandez des virements' },
    analytics: { title: 'Statistiques', subtitle: 'Analysez votre performance commerciale' },
    profile: { title: 'Profil de la marque', subtitle: 'Gérez votre identité publique' },
    support: { title: 'Support & Aide', subtitle: 'Nous sommes là pour vous aider' },
    settings: { title: 'Paramètres', subtitle: 'Gérez vos préférences et sécurité' }
  };
  
  const t = titles[section];
  if (t) {
    document.getElementById('page-title').textContent = t.title;
    document.getElementById('page-subtitle').textContent = t.subtitle;
  }
}

// ==========================================
// CHARGEMENT DES DONNÉES PAR SECTION
// ==========================================

async function loadSectionData(section) {
  showLoading(true);
  try {
    switch(section) {
      case 'overview':
        await loadOverview();
        break;
      case 'products':
        await loadCategories();
        await loadProducts();
        break;
      case 'orders':
        await loadOrders();
        break;
      case 'payments':
        await loadPayments();
        break;
      case 'analytics':
        await loadAnalytics();
        break;
      case 'profile':
        await loadProfile();
        break;
      case 'promotions':
        await loadPromotions();
        break;
    }
  } catch (error) {
    console.error(`Erreur chargement section ${section}:`, error);
    showToast('Erreur de chargement des données', 'error');
  } finally {
    showLoading(false);
  }
}

// ==========================================
// SECTION: OVERVIEW (Tableau de bord)
// ==========================================

async function loadOverview() {
  try {
    // Récupérer les statistiques du fournisseur
    const stats = await BrandiaAPI.Supplier.getStats();
    
    if (!stats.success) {
      throw new Error(stats.message || 'Erreur lors du chargement des statistiques');
    }
    
    const data = stats.data;
    
    // Mettre à jour les KPIs avec animation
    animateValue('kpi-revenue', data.finances?.revenue || 0, '€');
    animateValue('kpi-orders', data.orders?.total || 0, '');
    animateValue('kpi-products', data.products?.active || 0, '');
    document.getElementById('kpi-total-products').textContent = data.products?.total || 0;
    animateValue('kpi-balance', data.finances?.balance || 0, '€');
    
    // Tendances (comparaison avec période précédente)
    updateTrend('kpi-revenue-trend', data.finances?.revenueTrend);
    updateTrend('kpi-orders-trend', data.orders?.trend);
    
    // Prochain virement
    if (data.finances?.nextPayout) {
      const date = new Date(data.finances.nextPayout);
      document.getElementById('next-payout-date').textContent = 
        `Prochain virement: ${date.toLocaleDateString('fr-FR')}`;
    }
    
    // Badge commandes en attente
    const pendingOrders = data.orders?.pending || 0;
    const orderBadge = document.getElementById('order-badge');
    if (pendingOrders > 0) {
      orderBadge.textContent = pendingOrders;
      orderBadge.classList.remove('hidden');
    } else {
      orderBadge.classList.add('hidden');
    }
    
    // Rendu du graphique des ventes
    renderSalesChart(data.sales?.chartData || generateMockChartData());
    
    // Top produits
    renderTopProducts(data.topProducts || []);
    
    // Commandes récentes
    loadRecentOrders(data.orders?.recent || []);
    
  } catch (error) {
    console.error('Erreur loadOverview:', error);
    // Données de fallback
    document.getElementById('kpi-revenue').textContent = '0 €';
    document.getElementById('kpi-orders').textContent = '0';
    document.getElementById('kpi-products').textContent = '0';
    document.getElementById('kpi-balance').textContent = '0 €';
  }
}

function animateValue(elementId, value, suffix = '') {
  const element = document.getElementById(elementId);
  const start = 0;
  const duration = 1000;
  const startTime = performance.now();
  
  function update(currentTime) {
    const elapsed = currentTime - startTime;
    const progress = Math.min(elapsed / duration, 1);
    const easeProgress = 1 - Math.pow(1 - progress, 3); // easeOutCubic
    const current = Math.floor(start + (value - start) * easeProgress);
    
    element.textContent = formatPrice(current) + suffix;
    
    if (progress < 1) {
      requestAnimationFrame(update);
    }
  }
  
  requestAnimationFrame(update);
}

function updateTrend(elementId, trend) {
  const element = document.getElementById(elementId);
  if (!trend) {
    element.innerHTML = '<span class="text-slate-500">Pas de données</span>';
    return;
  }
  
  const isPositive = trend >= 0;
  const icon = isPositive ? 'fa-arrow-up' : 'fa-arrow-down';
  const color = isPositive ? 'text-emerald-400' : 'text-red-400';
  
  element.innerHTML = `
    <i class="fas ${icon} ${color}"></i>
    <span class="${color}">${Math.abs(trend).toFixed(1)}% ce mois</span>
  `;
}

function renderSalesChart(chartData) {
  const ctx = document.getElementById('salesChart');
  if (!ctx) return;
  
  // Détruire le graphique existant si présent
  if (currentState.charts.sales) {
    currentState.charts.sales.destroy();
  }
  
  currentState.charts.sales = new Chart(ctx, {
    type: 'line',
    data: {
      labels: chartData.labels || ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'],
      datasets: [{
        label: 'Ventes (€)',
        data: chartData.data || [0, 0, 0, 0, 0, 0, 0],
        borderColor: '#6366f1',
        backgroundColor: 'rgba(99, 102, 241, 0.1)',
        borderWidth: 2,
        fill: true,
        tension: 0.4,
        pointRadius: 4,
        pointBackgroundColor: '#6366f1',
        pointBorderColor: '#fff',
        pointBorderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#1e293b',
          titleColor: '#f1f5f9',
          bodyColor: '#f1f5f9',
          borderColor: '#334155',
          borderWidth: 1,
          padding: 12,
          callbacks: {
            label: function(context) {
              return 'Ventes: ' + formatPrice(context.parsed.y);
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          grid: { color: 'rgba(148, 163, 184, 0.1)' },
          ticks: { 
            color: '#94a3b8',
            callback: function(value) {
              return value + '€';
            }
          }
        },
        x: {
          grid: { display: false },
          ticks: { color: '#94a3b8' }
        }
      }
    }
  });
}

function renderTopProducts(products) {
  const container = document.getElementById('top-products-list');
  
  if (products.length === 0) {
    container.innerHTML = `
      <div class="text-center py-8 text-slate-500">
        <i class="fas fa-chart-pie text-3xl mb-3 opacity-50"></i>
        <p class="text-sm">Aucune vente encore</p>
      </div>
    `;
    return;
  }
  
  container.innerHTML = products.slice(0, 5).map((p, index) => `
    <div class="flex items-center gap-3">
      <div class="w-8 h-8 rounded-lg bg-indigo-500/20 flex items-center justify-center text-indigo-400 font-bold text-sm">
        ${index + 1}
      </div>
      <div class="flex-1 min-w-0">
        <p class="text-sm font-medium text-white truncate">${p.name}</p>
        <p class="text-xs text-slate-500">${p.sales} ventes</p>
      </div>
      <p class="text-sm font-semibold text-emerald-400">${formatPrice(p.revenue)}</p>
    </div>
  `).join('');
}

function loadRecentOrders(orders) {
  const tbody = document.getElementById('recent-orders-list');
  
  if (orders.length === 0) {
    tbody.innerHTML = '<tr><td colspan="5" class="py-8 text-center text-slate-500">Aucune commande récente</td></tr>';
    return;
  }
  
  tbody.innerHTML = orders.slice(0, 5).map(o => `
    <tr class="table-row border-b border-slate-800/50 last:border-0 cursor-pointer" onclick="viewOrder(${o.id})">
      <td class="py-4 px-6 font-medium text-white">#${o.order_number}</td>
      <td class="py-4 px-6 text-slate-400">${formatDate(o.created_at)}</td>
      <td class="py-4 px-6 text-slate-300">${o.customer_name || 'Client'}</td>
      <td class="py-4 px-6 text-right font-semibold text-white">${formatPrice(o.total_amount)}</td>
      <td class="py-4 px-6 text-center">
        <span class="badge badge-${o.status} text-xs">${getOrderStatusLabel(o.status)}</span>
      </td>
    </tr>
  `).join('');
}

async function updateSalesChart() {
  const period = document.getElementById('sales-period').value;
  try {
    const response = await BrandiaAPI.Supplier.getSalesChart(period);
    if (response.success) {
      renderSalesChart(response.data);
    }
  } catch (error) {
    console.error('Erreur mise à jour graphique:', error);
  }
}

// ==========================================
// SECTION: PRODUCTS
// ==========================================

async function loadCategories() {
  try {
    const response = await BrandiaAPI.Categories.getAll();
    if (response.success) {
      currentState.categories = response.data;
      
      // Remplir les selects de catégories
      const selects = ['product-category-select', 'product-category-filter', 'edit-brand-category'];
      selects.forEach(selectId => {
        const select = document.getElementById(selectId);
        if (select) {
          const currentValue = select.value;
          select.innerHTML = '<option value="">Choisir...</option>' + 
            response.data.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
          select.value = currentValue;
        }
      });
    }
  } catch (error) {
    console.error('Erreur chargement catégories:', error);
  }
}

async function loadProducts(page = 1) {
  currentState.currentProductPage = page;
  const grid = document.getElementById('products-grid');
  grid.innerHTML = '<div class="col-span-full text-center py-12"><i class="fas fa-spinner fa-spin text-3xl text-indigo-400"></i></div>';
  
  try {
    const search = document.getElementById('product-search')?.value || '';
    const status = document.getElementById('product-status-filter')?.value || '';
    const category = document.getElementById('product-category-filter')?.value || '';
    
    const response = await BrandiaAPI.Supplier.getProducts({
      page,
      limit: CONFIG.ITEMS_PER_PAGE,
      search,
      status,
      category_id: category
    });
    
    const products = response.data?.products || [];
    const total = response.data?.total || 0;
    
    // Mettre à jour le compteur
    const countBadge = document.getElementById('product-count');
    countBadge.textContent = total;
    countBadge.classList.remove('hidden');
    
    if (products.length === 0) {
      grid.innerHTML = `
        <div class="col-span-full text-center py-16 text-slate-500">
          <i class="fas fa-box-open text-5xl mb-4 opacity-50"></i>
          <p class="text-lg mb-2">Aucun produit</p>
          <p class="text-sm mb-6">Commencez par ajouter votre premier produit</p>
          <button onclick="openProductModal()" class="btn-primary px-6 py-3 rounded-lg font-medium">
            <i class="fas fa-plus mr-2"></i>Ajouter un produit
          </button>
        </div>
      `;
      document.getElementById('products-pagination').classList.add('hidden');
      return;
    }
    
    currentState.products = products;
    
    grid.innerHTML = products.map(p => `
      <div class="card rounded-xl overflow-hidden group">
        <div class="relative aspect-square bg-slate-800">
          <img src="${p.main_image_url || '/assets/images/placeholder-product.png'}" 
               alt="${p.name}" 
               class="w-full h-full object-cover transition-transform group-hover:scale-105"
               onerror="this.src='/assets/images/placeholder-product.png'">
          <div class="absolute top-3 right-3">
            <span class="badge badge-${p.status} text-xs">${getStatusLabel(p.status)}</span>
          </div>
          ${p.stock_quantity < 10 ? `
            <div class="absolute top-3 left-3">
              <span class="badge badge-archived text-xs">Stock faible</span>
            </div>
          ` : ''}
          <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
            <button onclick="editProduct(${p.id})" class="w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center text-white transition-colors" title="Modifier">
              <i class="fas fa-edit"></i>
            </button>
            <button onclick="duplicateProduct(${p.id})" class="w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center text-white transition-colors" title="Dupliquer">
              <i class="fas fa-copy"></i>
            </button>
            <button onclick="deleteProduct(${p.id})" class="w-10 h-10 bg-red-500/20 hover:bg-red-500/30 rounded-lg flex items-center justify-center text-red-400 transition-colors" title="Supprimer">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
        <div class="p-4">
          <h4 class="font-semibold text-white truncate mb-1" title="${p.name}">${p.name}</h4>
          <p class="text-slate-400 text-xs mb-3">${getCategoryName(p.category_id)}</p>
          <div class="flex items-center justify-between">
            <div>
              <p class="text-lg font-bold text-indigo-400">${formatPrice(p.price)}</p>
              ${p.compare_price ? `<p class="text-xs text-slate-500 line-through">${formatPrice(p.compare_price)}</p>` : ''}
            </div>
            <div class="text-right">
              <p class="text-xs text-slate-500">Stock</p>
              <p class="font-semibold ${p.stock_quantity < 10 ? 'text-red-400' : 'text-emerald-400'}">${p.stock_quantity}</p>
            </div>
          </div>
        </div>
      </div>
    `).join('');
    
    // Pagination
    const totalPages = Math.ceil(total / CONFIG.ITEMS_PER_PAGE);
    const pagination = document.getElementById('products-pagination');
    
    if (totalPages > 1) {
      pagination.classList.remove('hidden');
      document.getElementById('page-info').textContent = `Page ${page} sur ${totalPages}`;
      document.getElementById('prev-page').disabled = page === 1;
      document.getElementById('next-page').disabled = page === totalPages;
    } else {
      pagination.classList.add('hidden');
    }
    
  } catch (error) {
    console.error('Erreur chargement produits:', error);
    grid.innerHTML = '<div class="col-span-full text-center py-12 text-red-400">Erreur de chargement des produits</div>';
  }
}

function changeProductPage(direction) {
  const newPage = currentState.currentProductPage + direction;
  if (newPage >= 1) {
    loadProducts(newPage);
  }
}

function filterProducts() {
  // Debounce pour éviter trop d'appels
  clearTimeout(window.filterTimeout);
  window.filterTimeout = setTimeout(() => {
    loadProducts(1);
  }, 300);
}

function getCategoryName(categoryId) {
  const cat = currentState.categories.find(c => c.id === categoryId);
  return cat ? cat.name : 'Sans catégorie';
}

// ==========================================
// GESTION DES PRODUITS (CRUD)
// ==========================================

function openProductModal(productId = null) {
  const modal = document.getElementById('product-modal');
  const title = document.getElementById('product-modal-title');
  const form = document.getElementById('product-form');
  
  // Reset form
  form.reset();
  document.getElementById('product-id').value = '';
  document.getElementById('image-previews').innerHTML = '';
  document.getElementById('image-previews').classList.add('hidden');
  document.getElementById('upload-placeholder').classList.remove('hidden');
  
  // Reset caractéristiques
  document.getElementById('features-container').innerHTML = `
    <div class="flex gap-2 feature-row">
      <input type="text" name="feature_name[]" placeholder="Nom (ex: Matière)" class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:border-indigo-500 outline-none">
      <input type="text" name="feature_value[]" placeholder="Valeur (ex: Coton)" class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:border-indigo-500 outline-none">
      <button type="button" onclick="removeFeature(this)" class="text-red-400 hover:text-red-300 px-2">
        <i class="fas fa-times"></i>
      </button>
    </div>
  `;
  
  if (productId) {
    title.textContent = 'Modifier le produit';
    loadProductData(productId);
  } else {
    title.textContent = 'Ajouter un produit';
  }
  
  openModal('product-modal');
}

async function loadProductData(productId) {
  try {
    const response = await BrandiaAPI.Products.getById(productId);
    if (!response.success) throw new Error(response.message);
    
    const p = response.data;
    document.getElementById('product-id').value = p.id;
    
    // Remplir le formulaire
    const fields = ['name', 'sku', 'price', 'compare_price', 'stock_quantity', 
                   'short_description', 'description', 'weight', 'dimensions'];
    fields.forEach(field => {
      const input = document.querySelector(`[name="${field}"]`);
      if (input && p[field] !== null && p[field] !== undefined) {
        input.value = p[field];
      }
    });
    
    // Catégorie
    document.querySelector('[name="category_id"]').value = p.category_id || '';
    
    // Statut
    const statusRadio = document.querySelector(`[name="status"][value="${p.status}"]`);
    if (statusRadio) statusRadio.checked = true;
    
    // Images
    if (p.images && p.images.length > 0) {
      const previews = document.getElementById('image-previews');
      previews.innerHTML = p.images.map(img => `
        <div class="relative">
          <img src="${img.url}" class="image-preview">
          <button type="button" onclick="removeImage(this)" class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 rounded-full text-white text-xs flex items-center justify-center">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `).join('');
      previews.classList.remove('hidden');
      document.getElementById('upload-placeholder').classList.add('hidden');
    }
    
    // Caractéristiques
    if (p.features && p.features.length > 0) {
      const container = document.getElementById('features-container');
      container.innerHTML = p.features.map(f => `
        <div class="flex gap-2 feature-row">
          <input type="text" name="feature_name[]" value="${f.name}" placeholder="Nom" class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:border-indigo-500 outline-none">
          <input type="text" name="feature_value[]" value="${f.value}" placeholder="Valeur" class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:border-indigo-500 outline-none">
          <button type="button" onclick="removeFeature(this)" class="text-red-400 hover:text-red-300 px-2">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `).join('');
    }
    
  } catch (error) {
    showToast('Erreur lors du chargement du produit', 'error');
    console.error(error);
  }
}

async function saveProduct() {
  const form = document.getElementById('product-form');
  const formData = new FormData(form);
  const productId = document.getElementById('product-id').value;
  
  // Validation
  if (!formData.get('name') || !formData.get('price') || !formData.get('stock_quantity')) {
    showToast('Veuillez remplir tous les champs obligatoires', 'error');
    return;
  }
  
  // Préparer les données
  const data = {
    name: formData.get('name'),
    sku: formData.get('sku'),
    category_id: parseInt(formData.get('category_id')) || null,
    price: parseFloat(formData.get('price')),
    compare_price: formData.get('compare_price') ? parseFloat(formData.get('compare_price')) : null,
    stock_quantity: parseInt(formData.get('stock_quantity')),
    short_description: formData.get('short_description'),
    description: formData.get('description'),
    weight: formData.get('weight') ? parseFloat(formData.get('weight')) : null,
    dimensions: formData.get('dimensions'),
    status: formData.get('status'),
    features: []
  };
  
  // Caractéristiques
  const featureNames = formData.getAll('feature_name[]');
  const featureValues = formData.getAll('feature_value[]');
  for (let i = 0; i < featureNames.length; i++) {
    if (featureNames[i] && featureValues[i]) {
      data.features.push({ name: featureNames[i], value: featureValues[i] });
    }
  }
  
  // Images (à implémenter avec upload réel)
  const imageFiles = document.getElementById('product-images').files;
  if (imageFiles.length > 0) {
    // Upload des images d'abord, puis récupérer les URLs
    // Pour l'instant, on simule
    data.images = Array.from(imageFiles).map((f, i) => ({
      url: URL.createObjectURL(f),
      is_main: i === 0
    }));
  }
  
  try {
    setLoading('btn-save-product', true);
    
    let response;
    if (productId) {
      response = await BrandiaAPI.Supplier.updateProduct(productId, data);
    } else {
      response = await BrandiaAPI.Supplier.createProduct(data);
    }
    
    if (response.success) {
      showToast(productId ? 'Produit mis à jour !' : 'Produit créé avec succès !', 'success');
      closeModal('product-modal');
      loadProducts(currentState.currentProductPage);
    } else {
      throw new Error(response.message || 'Erreur lors de l\'enregistrement');
    }
  } catch (error) {
    showToast(error.message, 'error');
    console.error(error);
  } finally {
    setLoading('btn-save-product', false);
  }
}

async function deleteProduct(productId) {
  if (!confirm('Êtes-vous sûr de vouloir supprimer ce produit ? Cette action est irréversible.')) {
    return;
  }
  
  try {
    const response = await BrandiaAPI.Supplier.deleteProduct(productId);
    
    if (response.success) {
      showToast('Produit supprimé', 'success');
      loadProducts(currentState.currentProductPage);
    } else {
      throw new Error(response.message);
    }
  } catch (error) {
    showToast(error.message || 'Erreur lors de la suppression', 'error');
  }
}

function duplicateProduct(productId) {
  // Charger le produit et ouvrir le modal en mode création
  loadProductData(productId).then(() => {
    document.getElementById('product-id').value = '';
    document.getElementById('product-modal-title').textContent = 'Dupliquer le produit';
    document.querySelector('[name="sku"]').value = '';
    openModal('product-modal');
  });
}

// ==========================================
// UPLOAD D'IMAGES
// ==========================================

function handleImageUpload(event) {
  const files = event.target.files;
  const previews = document.getElementById('image-previews');
  const placeholder = document.getElementById('upload-placeholder');
  
  if (files.length > 0) {
    placeholder.classList.add('hidden');
    previews.classList.remove('hidden');
    
    Array.from(files).forEach((file, index) => {
      if (file.size > 5 * 1024 * 1024) {
        showToast(`L'image ${file.name} dépasse 5MB`, 'error');
        return;
      }
      
      const reader = new FileReader();
      reader.onload = (e) => {
        const div = document.createElement('div');
        div.className = 'relative';
        div.innerHTML = `
          <img src="${e.target.result}" class="image-preview">
          <button type="button" onclick="removeImage(this)" class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 rounded-full text-white text-xs flex items-center justify-center">
            <i class="fas fa-times"></i>
          </button>
          ${index === 0 ? '<span class="absolute bottom-1 left-1 bg-indigo-600 text-white text-xs px-2 py-0.5 rounded">Principale</span>' : ''}
        `;
        previews.appendChild(div);
      };
      reader.readAsDataURL(file);
    });
    
    document.getElementById('upload-status').textContent = `${files.length} image(s) sélectionnée(s)`;
  }
}

function removeImage(btn) {
  btn.parentElement.remove();
  const previews = document.getElementById('image-previews');
  if (previews.children.length === 0) {
    previews.classList.add('hidden');
    document.getElementById('upload-placeholder').classList.remove('hidden');
    document.getElementById('upload-status').textContent = '';
  }
}

// Drag & drop
const dropZone = document.getElementById('drop-zone');
if (dropZone) {
  dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.classList.add('border-indigo-500');
  });
  
  dropZone.addEventListener('dragleave', () => {
    dropZone.classList.remove('border-indigo-500');
  });
  
  dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.classList.remove('border-indigo-500');
    const files = e.dataTransfer.files;
    document.getElementById('product-images').files = files;
    handleImageUpload({ target: { files } });
  });
}

// ==========================================
// CARACTÉRISTIQUES PRODUIT
// ==========================================

function addFeature() {
  const container = document.getElementById('features-container');
  const div = document.createElement('div');
  div.className = 'flex gap-2 feature-row';
  div.innerHTML = `
    <input type="text" name="feature_name[]" placeholder="Nom (ex: Matière)" class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:border-indigo-500 outline-none">
    <input type="text" name="feature_value[]" placeholder="Valeur (ex: Coton)" class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:border-indigo-500 outline-none">
    <button type="button" onclick="removeFeature(this)" class="text-red-400 hover:text-red-300 px-2">
      <i class="fas fa-times"></i>
    </button>
  `;
  container.appendChild(div);
}

function removeFeature(btn) {
  btn.parentElement.remove();
}

// ==========================================
// SECTION: ORDERS
// ==========================================

async function loadOrders() {
  const container = document.getElementById('orders-list');
  container.innerHTML = '<div class="text-center py-12"><i class="fas fa-spinner fa-spin text-3xl text-indigo-400"></i></div>';
  
  try {
    const response = await BrandiaAPI.Supplier.getOrders({
      status: currentState.currentOrderFilter === 'all' ? null : currentState.currentOrderFilter
    });
    
    const orders = response.data?.orders || [];
    const counts = response.data?.counts || {};
    
    // Mettre à jour les compteurs d'onglets
    document.getElementById('count-all').textContent = counts.all || 0;
    document.getElementById('count-pending').textContent = counts.pending || 0;
    document.getElementById('count-paid').textContent = counts.paid || 0;
    document.getElementById('count-shipped').textContent = counts.shipped || 0;
    document.getElementById('count-delivered').textContent = counts.delivered || 0;
    
    currentState.orders = orders;
    
    if (orders.length === 0) {
      container.innerHTML = `
        <div class="card rounded-xl p-12 text-center text-slate-500">
          <i class="fas fa-shopping-bag text-5xl mb-4 opacity-50"></i>
          <p class="text-lg">Aucune commande</p>
          <p class="text-sm mt-2">Les commandes apparaîtront ici</p>
        </div>
      `;
      return;
    }
    
    renderOrdersList(orders);
    
  } catch (error) {
    console.error('Erreur chargement commandes:', error);
    container.innerHTML = '<div class="text-center py-12 text-red-400">Erreur de chargement des commandes</div>';
  }
}

function renderOrdersList(orders) {
  const container = document.getElementById('orders-list');
  
  container.innerHTML = orders.map(o => `
    <div class="card rounded-xl p-4 flex items-center gap-4 cursor-pointer hover:border-indigo-500/30 transition-colors" onclick="viewOrder(${o.id})">
      <div class="w-12 h-12 bg-indigo-500/10 rounded-xl flex items-center justify-center flex-shrink-0">
        <i class="fas fa-shopping-bag text-indigo-400"></i>
      </div>
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-2 mb-1">
          <span class="font-semibold text-white">#${o.order_number}</span>
          <span class="text-slate-500 text-sm">•</span>
          <span class="text-slate-400 text-sm">${formatDate(o.created_at)}</span>
        </div>
        <p class="text-slate-400 text-sm truncate">${o.items?.length || 0} article(s) • ${o.customer_name || 'Client'}</p>
      </div>
      <div class="text-right">
        <p class="font-bold text-white">${formatPrice(o.total_amount)}</p>
        <span class="badge badge-${o.status} text-xs mt-1">${getOrderStatusLabel(o.status)}</span>
      </div>
      <button class="p-2 text-slate-400 hover:text-white transition-colors">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  `).join('');
}

function filterOrders(status) {
  // Mettre à jour les onglets visuellement
  document.querySelectorAll('.order-tab').forEach(tab => {
    tab.classList.remove('active', 'bg-indigo-600', 'text-white');
    tab.classList.add('text-slate-400');
    
    if (tab.dataset.filter === status) {
      tab.classList.add('active', 'bg-indigo-600', 'text-white');
      tab.classList.remove('text-slate-400');
    }
  });
  
  currentState.currentOrderFilter = status;
  loadOrders();
}

async function viewOrder(orderId) {
  try {
    const response = await BrandiaAPI.Supplier.getOrder(orderId);
    if (!response.success) throw new Error(response.message);
    
    const order = response.data;
    
    document.getElementById('order-detail-number').textContent = '#' + order.order_number;
    
    const content = document.getElementById('order-detail-content');
    content.innerHTML = `
      <div class="grid grid-cols-2 gap-4 text-sm">
        <div>
          <label class="block text-xs text-slate-500 uppercase mb-1">Date</label>
          <p class="text-white">${formatDate(order.created_at, true)}</p>
        </div>
        <div>
          <label class="block text-xs text-slate-500 uppercase mb-1">Statut</label>
          <span class="badge badge-${order.status}">${getOrderStatusLabel(order.status)}</span>
        </div>
        <div>
          <label class="block text-xs text-slate-500 uppercase mb-1">Client</label>
          <p class="text-white">${order.customer_name || 'N/A'}</p>
          <p class="text-slate-400 text-xs">${order.customer_email || ''}</p>
        </div>
        <div>
          <label class="block text-xs text-slate-500 uppercase mb-1">Total</label>
          <p class="text-2xl font-bold text-emerald-400">${formatPrice(order.total_amount)}</p>
        </div>
      </div>
      
      <div class="border-t border-slate-800 pt-4">
        <h4 class="font-semibold mb-3">Articles</h4>
        <div class="space-y-3">
          ${order.items?.map(item => `
            <div class="flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg">
              <img src="${item.image_url || '/assets/images/placeholder-product.png'}" class="w-12 h-12 rounded object-cover">
              <div class="flex-1">
                <p class="font-medium text-sm">${item.product_name}</p>
                <p class="text-xs text-slate-500">${item.quantity} x ${formatPrice(item.unit_price)}</p>
              </div>
              <p class="font-semibold text-sm">${formatPrice(item.total)}</p>
            </div>
          `).join('') || '<p class="text-slate-500 text-sm">Aucun détail disponible</p>'}
        </div>
      </div>
      
      ${order.shipping_address ? `
        <div class="border-t border-slate-800 pt-4">
          <h4 class="font-semibold mb-3">Adresse de livraison</h4>
          <p class="text-sm text-slate-300 whitespace-pre-line">${formatAddress(order.shipping_address)}</p>
        </div>
      ` : ''}
    `;
    
    // Actions selon le statut
    const actions = document.getElementById('order-actions');
    actions.innerHTML = '';
    
    if (order.status === 'paid') {
      actions.innerHTML = `
        <button onclick="updateOrderStatus(${order.id}, 'processing')" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-500 rounded-lg text-sm font-medium">
          Marquer en préparation
        </button>
      `;
    } else if (order.status === 'processing') {
      actions.innerHTML = `
        <button onclick="updateOrderStatus(${order.id}, 'shipped')" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-500 rounded-lg text-sm font-medium">
          Marquer expédiée
        </button>
      `;
    } else if (order.status === 'shipped') {
      actions.innerHTML = `
        <button onclick="updateOrderStatus(${order.id}, 'delivered')" class="px-4 py-2 bg-emerald-600 hover:bg-emerald-500 rounded-lg text-sm font-medium">
          Marquer livrée
        </button>
      `;
    }
    
    actions.innerHTML += `
      <button onclick="closeModal('order-modal')" class="px-4 py-2 text-slate-400 hover:text-white transition-colors ml-auto">
        Fermer
      </button>
    `;
    
    openModal('order-modal');
    
  } catch (error) {
    showToast('Erreur lors du chargement de la commande', 'error');
    console.error(error);
  }
}

async function updateOrderStatus(orderId, status) {
  try {
    const response = await BrandiaAPI.Supplier.updateOrderStatus(orderId, status);
    if (response.success) {
      showToast('Statut mis à jour !', 'success');
      closeModal('order-modal');
      loadOrders();
      // Rafraîchir aussi l'overview si visible
      if (document.getElementById('overview').classList.contains('active')) {
        loadOverview();
      }
    } else {
      throw new Error(response.message);
    }
  } catch (error) {
    showToast(error.message || 'Erreur lors de la mise à jour', 'error');
  }
}

// ==========================================
// SECTION: PAYMENTS
// ==========================================

async function loadPayments() {
  try {
    const response = await BrandiaAPI.Supplier.getPayments();
    const data = response.data || {};
    
    animateValue('balance-available', data.available || 0, '€');
    animateValue('balance-pending', data.pending || 0, '€');
    animateValue('balance-total', data.total || 0, '€');
    
    // Statut Stripe
    const stripeStatus = document.getElementById('stripe-status');
    if (data.stripeAccountStatus === 'active') {
      stripeStatus.textContent = 'Actif';
      stripeStatus.className = 'text-emerald-400';
    } else if (data.stripeAccountStatus === 'pending') {
      stripeStatus.textContent = 'En attente de vérification';
      stripeStatus.className = 'text-amber-400';
    } else {
      stripeStatus.textContent = 'Non connecté';
      stripeStatus.className = 'text-red-400';
    }
    
    // Transactions
    renderTransactions(data.transactions || []);
    
  } catch (error) {
    console.error('Erreur chargement paiements:', error);
  }
}

function renderTransactions(transactions) {
  const tbody = document.getElementById('transactions-list');
  
  if (transactions.length === 0) {
    tbody.innerHTML = '<tr><td colspan="4" class="py-8 text-center text-slate-500">Aucune transaction pour le moment</td></tr>';
    return;
  }
  
  tbody.innerHTML = transactions.map(t => `
    <tr class="table-row">
      <td class="py-4 px-6 text-slate-400">${formatDate(t.created_at)}</td>
      <td class="py-4 px-6 text-white">${t.description}</td>
      <td class="py-4 px-6 text-right font-semibold ${t.amount >= 0 ? 'text-emerald-400' : 'text-red-400'}">
        ${t.amount >= 0 ? '+' : ''}${formatPrice(t.amount)}
      </td>
      <td class="py-4 px-6 text-center">
        <span class="badge badge-${t.status} text-xs">${getTransactionStatusLabel(t.status)}</span>
      </td>
    </tr>
  `).join('');
}

async function requestPayout() {
  try {
    const response = await BrandiaAPI.Supplier.getPayments();
    const available = response.data?.available || 0;
    
    if (available <= 0) {
      showToast('Aucun solde disponible', 'error');
      return;
    }
    
    const confirmed = confirm(`Demander un virement de ${formatPrice(available)} ?`);
    if (!confirmed) return;
    
    const result = await BrandiaAPI.Supplier.requestPayout(available);
    
    if (result.success) {
      showToast('Demande de virement envoyée !', 'success');
      loadPayments();
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    showToast(error.message || 'Erreur lors de la demande', 'error');
  }
}

function manageStripeAccount() {
  // Rediriger vers Stripe Express ou ouvrir le lien d'onboarding
  window.open('https://dashboard.stripe.com/express', '_blank');
}

function exportTransactions() {
  showToast('Export en cours...', 'info');
  // Implémenter l'export CSV
}

// ==========================================
// SECTION: ANALYTICS
// ==========================================

async function loadAnalytics() {
  try {
    const response = await BrandiaAPI.Supplier.getAnalytics(currentState.currentAnalyticsPeriod);
    const data = response.data || {};
    
    // Mettre à jour les stats détaillées
    document.getElementById('stat-avg-cart').textContent = formatPrice(data.avgCart || 0);
    document.getElementById('stat-conversion').textContent = (data.conversionRate || 0).toFixed(1) + '%';
    document.getElementById('stat-returning').textContent = (data.returningCustomers || 0).toFixed(0) + '%';
    
    // Tendances
    updateTrend('stat-avg-cart-trend', data.avgCartTrend);
    updateTrend('stat-conversion-trend', data.conversionRateTrend);
    updateTrend('stat-returning-trend', data.returningCustomersTrend);
    
    // Graphiques
    renderAnalyticsCharts(data);
    
  } catch (error) {
    console.error('Erreur chargement analytics:', error);
    // Données mockées en fallback
    renderAnalyticsCharts({
      sales: { labels: ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'], data: [120, 190, 150, 220, 280, 250, 310] },
      conversion: 3.2
    });
  }
}

function renderAnalyticsCharts(data) {
  // Graphique des ventes
  const salesCtx = document.getElementById('analyticsSalesChart');
  if (salesCtx) {
    if (currentState.charts.analyticsSales) {
      currentState.charts.analyticsSales.destroy();
    }
    
    currentState.charts.analyticsSales = new Chart(salesCtx, {
      type: 'bar',
      data: {
        labels: data.sales?.labels || [],
        datasets: [{
          label: 'Ventes',
          data: data.sales?.data || [],
          backgroundColor: '#6366f1',
          borderRadius: 4
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false }
        },
        scales: {
          y: {
            grid: { color: 'rgba(148, 163, 184, 0.1)' },
            ticks: { 
              color: '#94a3b8',
              callback: v => v + '€'
            }
          },
          x: {
            grid: { display: false },
            ticks: { color: '#94a3b8' }
          }
        }
      }
    });
  }
  
  // Graphique de conversion (doughnut)
  const convCtx = document.getElementById('conversionChart');
  if (convCtx) {
    if (currentState.charts.conversion) {
      currentState.charts.conversion.destroy();
    }
    
    const conversionRate = data.conversion || 3.2;
    currentState.charts.conversion = new Chart(convCtx, {
      type: 'doughnut',
      data: {
        labels: ['Converti', 'Non converti'],
        datasets: [{
          data: [conversionRate, 100 - conversionRate],
          backgroundColor: ['#6366f1', '#334155'],
          borderWidth: 0
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        cutout: '70%',
        plugins: {
          legend: { 
            position: 'bottom',
            labels: { color: '#94a3b8', padding: 20 }
          }
        }
      }
    });
  }
}

function updateAnalyticsPeriod(period) {
  currentState.currentAnalyticsPeriod = period;
  
  // Mettre à jour les boutons visuellement
  document.querySelectorAll('.analytics-period').forEach(btn => {
    btn.classList.remove('bg-indigo-600', 'text-white');
    btn.classList.add('bg-slate-800', 'text-slate-300');
    
    if (parseInt(btn.dataset.period) === period || btn.dataset.period === period) {
      btn.classList.remove('bg-slate-800', 'text-slate-300');
      btn.classList.add('bg-indigo-600', 'text-white');
    }
  });
  
  loadAnalytics();
}

// ==========================================
// SECTION: PROFILE
// ==========================================

async function loadProfile() {
  try {
    const response = await BrandiaAPI.Supplier.getProfile();
    if (!response.success) throw new Error(response.message);
    
    const profile = response.data;
    
    // Logo
    if (profile.logo_url) {
      document.getElementById('brand-logo-img').src = profile.logo_url;
      document.getElementById('brand-logo-img').classList.remove('hidden');
      document.getElementById('brand-logo-icon').classList.add('hidden');
    }
    
    // Infos de base
    document.getElementById('brand-name').textContent = profile.company_name || 'Votre Marque';
    document.getElementById('brand-category').textContent = getCategoryName(profile.category) || 'Catégorie non définie';
    document.getElementById('brand-description').textContent = profile.description || 'Aucune description';
    document.getElementById('brand-website').textContent = profile.website || '--';
    document.getElementById('brand-website').href = profile.website || '#';
    document.getElementById('brand-email').textContent = profile.email || '--';
    
    // Adresse
    document.getElementById('address-street').textContent = profile.address || '--';
    document.getElementById('address-city').textContent = profile.city || '--';
    document.getElementById('address-postal').textContent = profile.postal_code || '--';
    document.getElementById('address-country').textContent = profile.country || '--';
    
    // Réseaux sociaux
    document.getElementById('social-instagram').value = profile.instagram_url || '';
    document.getElementById('social-facebook').value = profile.facebook_url || '';
    document.getElementById('social-tiktok').value = profile.tiktok_url || '';
    document.getElementById('social-linkedin').value = profile.linkedin_url || '';
    
    // Légal
    document.getElementById('legal-siret').textContent = profile.siret || '--';
    document.getElementById('legal-vat').textContent = profile.vat_number || '--';
    document.getElementById('legal-form').textContent = profile.legal_form || '--';
    
    // Remplir le formulaire d'édition
    document.getElementById('edit-brand-name').value = profile.company_name || '';
    document.getElementById('edit-brand-description').value = profile.description || '';
    document.getElementById('edit-brand-website').value = profile.website || '';
    document.getElementById('edit-brand-email').value = profile.email || '';
    
  } catch (error) {
    console.error('Erreur chargement profil:', error);
    showToast('Erreur lors du chargement du profil', 'error');
  }
}

function editBrand() {
  document.getElementById('brand-display').classList.add('hidden');
  document.getElementById('brand-form').classList.remove('hidden');
}

function cancelEditBrand() {
  document.getElementById('brand-form').classList.add('hidden');
  document.getElementById('brand-display').classList.remove('hidden');
}

async function saveBrand() {
  const data = {
    company_name: document.getElementById('edit-brand-name').value,
    description: document.getElementById('edit-brand-description').value,
    website: document.getElementById('edit-brand-website').value,
    email: document.getElementById('edit-brand-email').value,
    category: document.getElementById('edit-brand-category').value
  };
  
  try {
    const response = await BrandiaAPI.Supplier.updateProfile(data);
    
    if (response.success) {
      // Mettre à jour l'affichage
      document.getElementById('brand-name').textContent = data.company_name;
      document.getElementById('brand-description').textContent = data.description;
      document.getElementById('brand-website').textContent = data.website || '--';
      document.getElementById('brand-website').href = data.website || '#';
      document.getElementById('brand-email').textContent = data.email || '--';
      document.getElementById('brand-category').textContent = getCategoryName(data.category) || 'Catégorie non définie';
      
      cancelEditBrand();
      showToast('Profil mis à jour !', 'success');
    } else {
      throw new Error(response.message);
    }
  } catch (error) {
    showToast(error.message || 'Erreur lors de la mise à jour', 'error');
  }
}

async function handleLogoUpload(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  if (file.size > 2 * 1024 * 1024) {
    showToast('L\'image ne doit pas dépasser 2MB', 'error');
    return;
  }
  
  try {
    const formData = new FormData();
    formData.append('logo', file);
    
    const response = await BrandiaAPI.Supplier.uploadLogo(formData);
    
    if (response.success) {
      document.getElementById('brand-logo-img').src = response.data.logo_url;
      document.getElementById('brand-logo-img').classList.remove('hidden');
      document.getElementById('brand-logo-icon').classList.add('hidden');
      showToast('Logo mis à jour !', 'success');
    } else {
      throw new Error(response.message);
    }
  } catch (error) {
    showToast(error.message || 'Erreur lors de l\'upload', 'error');
  }
}

function viewPublicProfile() {
  // Ouvrir la page publique de la marque
  const brandName = document.getElementById('brand-name').textContent;
  window.open(`/brand/${encodeURIComponent(brandName)}`, '_blank');
}

// Adresse
function editAddress() {
  document.getElementById('address-display').classList.add('hidden');
  document.getElementById('address-form').classList.remove('hidden');
  
  // Pré-remplir
  document.getElementById('edit-address-street').value = document.getElementById('address-street').textContent !== '--' ? document.getElementById('address-street').textContent : '';
  document.getElementById('edit-address-city').value = document.getElementById('address-city').textContent !== '--' ? document.getElementById('address-city').textContent : '';
  document.getElementById('edit-address-postal').value = document.getElementById('address-postal').textContent !== '--' ? document.getElementById('address-postal').textContent : '';
}

function cancelEditAddress() {
  document.getElementById('address-form').classList.add('hidden');
  document.getElementById('address-display').classList.remove('hidden');
}

async function saveAddress() {
  const data = {
    address: document.getElementById('edit-address-street').value,
    city: document.getElementById('edit-address-city').value,
    postal_code: document.getElementById('edit-address-postal').value,
    country: document.getElementById('edit-address-country').value
  };
  
  try {
    const response = await BrandiaAPI.Supplier.updateProfile(data);
    if (response.success) {
      document.getElementById('address-street').textContent = data.address || '--';
      document.getElementById('address-city').textContent = data.city || '--';
      document.getElementById('address-postal').textContent = data.postal_code || '--';
      document.getElementById('address-country').textContent = data.country || '--';
      cancelEditAddress();
      showToast('Adresse mise à jour !', 'success');
    }
  } catch (error) {
    showToast('Erreur lors de la mise à jour', 'error');
  }
}

// Réseaux sociaux
async function saveSocialMedia() {
  const data = {
    instagram_url: document.getElementById('social-instagram').value,
    facebook_url: document.getElementById('social-facebook').value,
    tiktok_url: document.getElementById('social-tiktok').value,
    linkedin_url: document.getElementById('social-linkedin').value
  };
  
  try {
    const response = await BrandiaAPI.Supplier.updateProfile(data);
    if (response.success) {
      showToast('Réseaux sociaux mis à jour !', 'success');
    }
  } catch (error) {
    showToast('Erreur lors de la mise à jour', 'error');
  }
}

// ==========================================
// SECTION: PROMOTIONS
// ==========================================

async function loadPromotions() {
  try {
    const response = await BrandiaAPI.Supplier.getPromotions();
    const promotions = response.data || [];
    
    const activeContainer = document.getElementById('active-promotions');
    const historyContainer = document.getElementById('promotion-history');
    
    const active = promotions.filter(p => p.status === 'active');
    const history = promotions.filter(p => p.status !== 'active');
    
    if (active.length === 0) {
      activeContainer.innerHTML = `
        <div class="p-8 text-center text-slate-500">
          <i class="fas fa-percent text-4xl mb-4 opacity-50"></i>
          <p>Aucune promotion active</p>
          <button onclick="openPromotionModal()" class="mt-4 text-indigo-400 hover:text-indigo-300 text-sm font-medium">
            Créer une promotion
          </button>
        </div>
      `;
    } else {
      activeContainer.innerHTML = active.map(p => `
        <div class="p-4 flex items-center justify-between hover:bg-slate-800/50 transition-colors">
          <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-indigo-500/10 rounded-xl flex items-center justify-center">
              <i class="fas fa-percent text-indigo-400"></i>
            </div>
            <div>
              <h4 class="font-semibold text-white">${p.name}</h4>
              <p class="text-sm text-slate-400">${p.type === 'percentage' ? '-' + p.value + '%' : '-' + formatPrice(p.value)} • Jusqu'au ${formatDate(p.end_date)}</p>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <span class="badge badge-published">Active</span>
            <button onclick="editPromotion(${p.id})" class="p-2 text-slate-400 hover:text-white">
              <i class="fas fa-edit"></i>
            </button>
            <button onclick="deletePromotion(${p.id})" class="p-2 text-red-400 hover:text-red-300">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      `).join('');
    }
    
    if (history.length === 0) {
      historyContainer.innerHTML = `
        <div class="p-6 text-center text-slate-500">
          <p class="text-sm">Les promotions expirées apparaîtront ici</p>
        </div>
      `;
    } else {
      historyContainer.innerHTML = history.map(p => `
        <div class="p-4 flex items-center justify-between hover:bg-slate-800/50 transition-colors opacity-60">
          <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-slate-700 rounded-xl flex items-center justify-center">
              <i class="fas fa-percent text-slate-400"></i>
            </div>
            <div>
              <h4 class="font-semibold text-white">${p.name}</h4>
              <p class="text-sm text-slate-400">Terminée le ${formatDate(p.end_date)}</p>
            </div>
          </div>
          <span class="badge badge-archived">Expirée</span>
        </div>
      `).join('');
    }
    
  } catch (error) {
    console.error('Erreur chargement promotions:', error);
  }
}

async function savePromotion() {
  const form = document.getElementById('promotion-form');
  const formData = new FormData(form);
  
  const data = {
    name: formData.get('name'),
    type: formData.get('type'),
    value: parseFloat(formData.get('value')),
    start_date: formData.get('start_date'),
    end_date: formData.get('end_date'),
    applies_to: formData.get('applies_to')
  };
  
  try {
    setLoading('btn-save-promotion', true);
    
    const response = await BrandiaAPI.Supplier.createPromotion(data);
    
    if (response.success) {
      showToast('Promotion créée !', 'success');
      closeModal('promotion-modal');
      loadPromotions();
    } else {
      throw new Error(response.message);
    }
  } catch (error) {
    showToast(error.message || 'Erreur lors de la création', 'error');
  } finally {
    setLoading('btn-save-promotion', false);
  }
}

// ==========================================
// SECTION: SUPPORT
// ==========================================

async function submitTicket() {
  const form = document.getElementById('ticket-form');
  const formData = new FormData(form);
  
  const data = {
    subject: formData.get('subject'),
    category: formData.get('category'),
    message: formData.get('message')
  };
  
  try {
    setLoading('btn-submit-ticket', true);
    
    const response = await BrandiaAPI.Support.createTicket(data);
    
    if (response.success) {
      showToast('Ticket envoyé !', 'success');
      closeModal('ticket-modal');
      form.reset();
      document.getElementById('ticket-file-name').textContent = '';
    } else {
      throw new Error(response.message);
    }
  } catch (error) {
    showToast(error.message || 'Erreur lors de l\'envoi', 'error');
  } finally {
    setLoading('btn-submit-ticket', false);
  }
}

function handleTicketAttachment(event) {
  const file = event.target.files[0];
  if (file) {
    document.getElementById('ticket-file-name').textContent = file.name;
  }
}

// ==========================================
// SECTION: SETTINGS
// ==========================================

async function updateSetting(key, value) {
  try {
    const response = await BrandiaAPI.User.updateSettings({ [key]: value });
    if (response.success) {
      showToast('Paramètre mis à jour', 'success');
    }
  } catch (error) {
    showToast('Erreur lors de la mise à jour', 'error');
  }
}

async function updateNotification(type, enabled) {
  try {
    const response = await BrandiaAPI.User.updateNotifications({ [type]: enabled });
    if (response.success) {
      showToast('Préférences mises à jour', 'success');
    }
  } catch (error) {
    showToast('Erreur lors de la mise à jour', 'error');
  }
}

function changePassword() {
  const current = prompt('Mot de passe actuel:');
  if (!current) return;
  
  const newPass = prompt('Nouveau mot de passe (min 8 caractères):');
  if (!newPass || newPass.length < 8) {
    showToast('Le mot de passe doit faire au moins 8 caractères', 'error');
    return;
  }
  
  const confirm = prompt('Confirmer le nouveau mot de passe:');
  if (newPass !== confirm) {
    showToast('Les mots de passe ne correspondent pas', 'error');
    return;
  }
  
  BrandiaAPI.Auth.changePassword({ current, new: newPass })
    .then(response => {
      if (response.success) {
        showToast('Mot de passe modifié !', 'success');
      } else {
        throw new Error(response.message);
      }
    })
    .catch(error => {
      showToast(error.message || 'Erreur lors du changement', 'error');
    });
}

function setup2FA() {
  showToast('Fonctionnalité bientôt disponible', 'info');
}

function manageSessions() {
  showToast('Fonctionnalité bientôt disponible', 'info');
}

function toggleShopStatus() {
  const btn = document.getElementById('btn-toggle-shop');
  const currentText = btn.textContent;
  const newStatus = currentText === 'Désactiver' ? 'inactive' : 'active';
  
  if (confirm(`Voulez-vous vraiment ${newStatus === 'inactive' ? 'désactiver' : 'activer'} votre boutique ?`)) {
    BrandiaAPI.Supplier.updateShopStatus({ status: newStatus })
      .then(response => {
        if (response.success) {
          btn.textContent = newStatus === 'inactive' ? 'Activer' : 'Désactiver';
          btn.className = newStatus === 'inactive' 
            ? 'px-4 py-2 bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20 rounded-lg text-sm font-medium transition-colors'
            : 'px-4 py-2 bg-red-500/10 text-red-400 hover:bg-red-500/20 rounded-lg text-sm font-medium transition-colors';
          showToast(`Boutique ${newStatus === 'inactive' ? 'désactivée' : 'activée'}`, 'success');
        }
      })
      .catch(error => {
        showToast('Erreur lors du changement de statut', 'error');
      });
  }
}

function deleteAccount() {
  const confirm1 = confirm('Êtes-vous sûr de vouloir supprimer votre compte ? Cette action est irréversible.');
  if (!confirm1) return;
  
  const confirm2 = prompt('Tapez "SUPPRIMER" pour confirmer:');
  if (confirm2 !== 'SUPPRIMER') {
    showToast('Suppression annulée', 'info');
    return;
  }
  
  BrandiaAPI.User.deleteAccount()
    .then(() => {
      showToast('Compte supprimé. Déconnexion...', 'success');
      setTimeout(() => logout(), 2000);
    })
    .catch(error => {
      showToast('Erreur lors de la suppression', 'error');
    });
}

// ==========================================
// UTILITAIRES
// ==========================================

function openModal(id) {
  document.getElementById(id).classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}

function closeModal(id) {
  document.getElementById(id).classList.add('hidden');
  document.body.style.overflow = '';
  
  // Reset form si existe
  const form = document.querySelector(`#${id} form`);
  if (form && id !== 'order-modal') form.reset();
}

function showLoading(show) {
  const overlay = document.getElementById('loading-overlay');
  if (show) {
    overlay.classList.remove('hidden');
  } else {
    overlay.classList.add('hidden');
  }
}

function setLoading(btnId, loading) {
  const btn = document.getElementById(btnId);
  const spinner = btn.querySelector('.fa-spinner');
  
  if (loading) {
    btn.disabled = true;
    spinner.classList.remove('hidden');
  } else {
    btn.disabled = false;
    spinner.classList.add('hidden');
  }
}

function showToast(message, type = 'info') {
  const container = document.getElementById('toast-container');
  
  const toast = document.createElement('div');
  toast.className = `flex items-center gap-3 px-6 py-4 rounded-lg shadow-lg transform translate-x-full transition-all duration-300 ${
    type === 'success' ? 'bg-emerald-500 text-white' :
    type === 'error' ? 'bg-red-500 text-white' :
    type === 'warning' ? 'bg-amber-500 text-white' :
    'bg-indigo-500 text-white'
  }`;
  
  const icon = type === 'success' ? 'fa-check-circle' :
               type === 'error' ? 'fa-exclamation-circle' :
               type === 'warning' ? 'fa-exclamation-triangle' :
               'fa-info-circle';
  
  toast.innerHTML = `
    <i class="fas ${icon}"></i>
    <span class="font-medium">${message}</span>
  `;
  
  container.appendChild(toast);
  
  // Animer l'entrée
  setTimeout(() => toast.classList.remove('translate-x-full'), 100);
  
  // Supprimer après 3 secondes
  setTimeout(() => {
    toast.classList.add('translate-x-full');
    setTimeout(() => toast.remove(), 300);
  }, 3000);
}

function formatPrice(amount) {
  return new Intl.NumberFormat('fr-FR', {
    style: 'currency',
    currency: 'EUR'
  }).format(amount);
}

function formatDate(dateString, withTime = false) {
  if (!dateString) return '--';
  const date = new Date(dateString);
  const options = {
    day: '2-digit',
    month: 'short',
    year: 'numeric'
  };
  if (withTime) {
    options.hour = '2-digit';
    options.minute = '2-digit';
  }
  return date.toLocaleDateString('fr-FR', options);
}

function formatAddress(address) {
  if (!address) return '--';
  return `${address.street}\n${address.postal_code} ${address.city}\n${address.country}`;
}

function getStatusLabel(status) {
  const labels = {
    draft: 'Brouillon',
    published: 'Publié',
    archived: 'Archivé',
    active: 'Actif',
    inactive: 'Inactif'
  };
  return labels[status] || status;
}

function getOrderStatusLabel(status) {
  const labels = {
    pending: 'À préparer',
    paid: 'Payée',
    processing: 'En préparation',
    shipped: 'Expédiée',
    delivered: 'Livrée',
    cancelled: 'Annulée',
    refunded: 'Remboursée'
  };
  return labels[status] || status;
}

function getTransactionStatusLabel(status) {
  const labels = {
    pending: 'En attente',
    available: 'Disponible',
    paid: 'Payé',
    failed: 'Échoué'
  };
  return labels[status] || status;
}

function generateMockChartData() {
  return {
    labels: ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'],
    data: Array.from({ length: 7 }, () => Math.floor(Math.random() * 500) + 100)
  };
}

function quickAction() {
  const actions = [
    { label: 'Ajouter un produit', icon: 'fa-box', action: () => openProductModal() },
    { label: 'Créer une promotion', icon: 'fa-percent', action: () => openPromotionModal() },
    { label: 'Voir les commandes', icon: 'fa-shopping-bag', action: () => navigate('orders') },
    { label: 'Demander un virement', icon: 'fa-euro-sign', action: () => requestPayout() }
  ];
  
  const choice = prompt('Action rapide:\n1. Ajouter un produit\n2. Créer une promotion\n3. Voir les commandes\n4. Demander un virement');
  
  const index = parseInt(choice) - 1;
  if (index >= 0 && index < actions.length) {
    actions[index].action();
  }
}

function showNotifications() {
  showToast('Pas de nouvelles notifications', 'info');
}

function logout() {
  if (confirm('Êtes-vous sûr de vouloir vous déconnecter ?')) {
    BrandiaAPI.Auth.logout();
  }
}

// ==========================================
// INITIALISATION
// ==========================================

document.addEventListener('DOMContentLoaded', () => {
  console.log('Dashboard Brandia chargé');
  
  // Vérifier l'authentification
  const user = BrandiaAPI.Auth.getUser();
  
  if (!BrandiaAPI.Auth.isLoggedIn()) {
    window.location.href = '../login.html?redirect=supplier/dashboard.html';
    return;
  }
  
  if (user.role !== 'supplier') {
    alert('Accès réservé aux fournisseurs');
    window.location.href = '../index.html';
    return;
  }
  
  // Mettre à jour les infos utilisateur
  document.getElementById('user-name').textContent = user.first_name || user.email;
  
  // Setup handlers de formulaires
  document.getElementById('product-form')?.addEventListener('submit', (e) => {
    e.preventDefault();
    saveProduct();
  });
  
  document.getElementById('promotion-form')?.addEventListener('submit', (e) => {
    e.preventDefault();
    savePromotion();
  });
  
  document.getElementById('ticket-form')?.addEventListener('submit', (e) => {
    e.preventDefault();
    submitTicket();
  });
  
  // Changement de type de promo
  document.querySelectorAll('input[name="type"]').forEach(radio => {
    radio.addEventListener('change', (e) => {
      const suffix = e.target.value === 'percentage' ? '%' : '€';
      document.getElementById('promo-value-suffix').textContent = suffix;
    });
  });
  
  // Charger les données initiales
  navigate('overview');
  
  // Raccourcis clavier
  document.addEventListener('keydown', (e) => {
    // Échap pour fermer les modals
    if (e.key === 'Escape') {
      document.querySelectorAll('[id$="-modal"]').forEach(modal => {
        if (!modal.classList.contains('hidden')) {
          closeModal(modal.id);
        }
      });
    }
    
    // Ctrl/Cmd + K pour recherche
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
      e.preventDefault();
      document.getElementById('global-search')?.focus();
    }
  });
  
  // Recherche globale
  document.getElementById('global-search')?.addEventListener('input', (e) => {
    const query = e.target.value.toLowerCase();
    if (query.length > 2) {
      // Implémenter la recherche globale
      console.log('Recherche:', query);
    }
  });
});

// Exposer les fonctions globales pour les onclick inline
window.navigate = navigate;
window.openModal = openModal;
window.closeModal = closeModal;
window.openProductModal = openProductModal;
window.editProduct = editProduct;
window.deleteProduct = deleteProduct;
window.duplicateProduct = duplicateProduct;
window.saveProduct = saveProduct;
window.filterProducts = filterProducts;
window.changeProductPage = changeProductPage;
window.handleImageUpload = handleImageUpload;
window.removeImage = removeImage;
window.addFeature = addFeature;
window.removeFeature = removeFeature;
window.openPromotionModal = openPromotionModal;
window.savePromotion = savePromotion;
window.filterOrders = filterOrders;
window.viewOrder = viewOrder;
window.updateOrderStatus = updateOrderStatus;
window.requestPayout = requestPayout;
window.manageStripeAccount = manageStripeAccount;
window.exportTransactions = exportTransactions;
window.updateAnalyticsPeriod = updateAnalyticsPeriod;
window.editBrand = editBrand;
window.cancelEditBrand = cancelEditBrand;
window.saveBrand = saveBrand;
window.handleLogoUpload = handleLogoUpload;
window.viewPublicProfile = viewPublicProfile;
window.editAddress = editAddress;
window.cancelEditAddress = cancelEditAddress;
window.saveAddress = saveAddress;
window.saveSocialMedia = saveSocialMedia;
window.submitTicket = submitTicket;
window.handleTicketAttachment = handleTicketAttachment;
window.updateSetting = updateSetting;
window.updateNotification = updateNotification;
window.changePassword = changePassword;
window.setup2FA = setup2FA;
window.manageSessions = manageSessions;
window.toggleShopStatus = toggleShopStatus;
window.deleteAccount = deleteAccount;
window.quickAction = quickAction;
window.showNotifications = showNotifications;
window.logout = logout;
window.importProducts = () => showToast('Fonctionnalité à venir', 'info');
</script>

</body>
</html>